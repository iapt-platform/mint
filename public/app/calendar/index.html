<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<link href="../lib/main.css" rel="stylesheet" />
	<script src="../public/js/jquery.js"></script>
	<script src="../public/js/comm.js"></script>
	<script src="jquery-3.3.1.min.js"></script>
	<script src="julian.js"></script>
	<script src="lune.js"></script>
	<script src="suncalc.js"></script>
	<script src="./planet_position/js/planet-positions.js"></script>

	<script src="city_15000.js"></script>
	<script src="../studio/js/fixedsticky.js"></script>
	<script src="../guide/guide.js"></script>
	<link type="text/css" rel="stylesheet" href="../guide/guide.css" />

	<script src="../public/js/marked.js"></script>
	<!--è·å–è¯­è¨€-->

	<script>
		var g_language = getCookie("language");
	</script>
	<!--è¯­è¨€åŒ…-->
	<script>
		var localString = new Array();
		localString["zh-cn"] = {
			and_another: "åˆ ",
			atitude: "çº¬åº¦",
			BE: "ä½›å†",
			bhumma: "å‘¨äºŒ",
			budha: "å‘¨ä¸‰",
			canda: "å‘¨ä¸€",
			confirm: "ç¡®è®¤",
			date: "æ—¥æœŸ",
			day: "æ—¥",
			days: "å¤© ",
			departure_in_detail: "èµ·é£è¯¦æƒ…",
			dhamma_time: "ä¼šå»¶ç»­äº”åƒå¹´çš„æ•™æ³• ",
			eat: "è¿›é¤",
			gama_entry: "å…¥æ‘",
			guru: "å‘¨å››",
			hori_ref_time: "è’™æ°”å·®ä¿®æ­£ ",
			kala: "é€‚å½“çš„æ—¶é—´",
			language_select: "é€‰æ‹©è¯­è¨€",
			left: "è¿˜å‰©ä¸‹",
			loading: "è½½å…¥ä¸­â€¦â€¦",
			longitude: "ç»åº¦",
			mÄsa: "æœˆ",
			mins: "åˆ†é’Ÿ",
			month: "æœˆ ",
			month_1: "æœˆ ",
			months: "ä¸ªæœˆ ",
			my_loc: "æˆ‘çš„ä½ç½®",
			need_inform: "æœªå‘ŠçŸ¥å…¶ä»–æ¯”åº“",
			no_string: "ä¸èƒ½",
			noon_time: "æ­£åˆ",
			noon_time: "æ­£åˆ",
			note: "æ³¨é‡Š",
			now_time: "ç°åœ¨",
			pacchÄ_mÄsa: "ä¸‹ä¸ªæœˆ",
			pakkha: "æœˆç›¸å˜åŒ– ",
			past: "å·²è¿‡å»",
			pubba_mÄsa: "ä¸Šä¸ªæœˆ",
			ravi: "å‘¨æ—¥",
			saá¹ƒvacchara: "å¹´",
			season: "å­£èŠ‚ ",
			sec: "ç§’",
			sora: "å‘¨å…­",
			sukka: "å‘¨äº”",
			sun_height_degree: "æ­£åˆå¤ªé˜³é«˜åº¦ ",
			time: "æ—¶é—´",
			twilight_time: "æ›™å…‰",
			twilight_time: "æ›™å…‰",
			vikala: "ä¸é€‚å½“çš„æ—¶é—´",
			week_day: "æ˜ŸæœŸ",
			year_0: "å¹´",
			year_1: "å¹´ ",
			years: "å¹´ ",
			yes_string: "å¯ä»¥",
			timezone: "æ—¶åŒº",
			local: "æœ¬åœ°",
			loading: "è½½å…¥ä¸­",
			sun_set: "æ—¥è½",
			unknown: "æœªçŸ¥",
			altitude: "æµ·æ‹”",
			today: "ä»Šå¤©",
			week: "å‘¨",
			list: "åˆ—è¡¨",
			location: "æ‰€åœ¨åœ°",
			city_name: "åŸå¸‚å",
			re_loc: "é‡æ–°å®šä½",
		};
		localString["zh-tw"] = {
			and_another: "åˆ ",
			atitude: "ç·¯åº¦",
			BE: "ä½›æ›†",
			bhumma: "é€±äºŒ",
			budha: "é€±ä¸‰",
			canda: "é€±ä¸€",
			confirm: "ç¢ºèª",
			date: "æ—¥æœŸ",
			day: "æ—¥",
			days: "å¤© ",
			departure_in_detail: "èµ·é£›è©³æƒ…",
			dhamma_time: "æœƒå»¶çºŒäº”åƒå¹´çš„æ•™æ³• ",
			eat: "é€²é¤",
			gama_entry: "å…¥æ‘",
			guru: "é€±å››",
			hori_ref_time: "è’™æ°£å·®ä¿®æ­£ ",
			kala: "é©ç•¶çš„æ™‚é–“",
			language_select: "é¸æ“‡èªè¨€",
			left: "é‚„å‰©ä¸‹",
			loading: "è¼‰å…¥ä¸­â€¦â€¦",
			longitude: "ç¶“åº¦",
			mÄsa: "æœˆ",
			mins: "åˆ†é˜",
			month: "æœˆ ",
			month_1: "æœˆ ",
			months: "å€‹æœˆ ",
			my_loc: "æˆ‘çš„ä½ç½®",
			need_inform: "æœªå‘ŠçŸ¥å…¶ä»–æ¯”åº«",
			no_string: "ä¸èƒ½",
			noon_time: "æ­£åˆ",
			noon_time: "æ­£åˆ",
			note: "è¨»é‡‹",
			now_time: "ç¾åœ¨",
			pacchÄ_mÄsa: "ä¸‹å€‹æœˆ",
			pakkha: "æœˆç›¸è®ŠåŒ– ",
			past: "å·²éå»",
			pubba_mÄsa: "ä¸Šå€‹æœˆ",
			ravi: "é€±æ—¥",
			saá¹ƒvacchara: "å¹´",
			season: "å­£ç¯€ ",
			sec: "ç§’",
			sora: "é€±å…­",
			sukka: "é€±äº”",
			sun_height_degree: "æ­£åˆå¤ªé™½é«˜åº¦ ",
			time: "æ™‚é–“",
			twilight_time: "æ›™å…‰",
			twilight_time: "æ›™å…‰",
			vikala: "ä¸é©ç•¶çš„æ™‚é–“",
			week_day: "æ˜ŸæœŸ",
			year_0: "å¹´",
			year_1: "å¹´ ",
			years: "å¹´ ",
			yes_string: "å¯ä»¥",
			timezone: "æ™‚å€",
			local: "æœ¬åœ°",
			loading: "è¼‰å…¥ä¸­",
			sun_set: "æ—¥è½",
			unknown: "æœªçŸ¥",
			altitude: "æµ·æ‹”",
			today: "ä»Šå¤©",
			week: "å‘¨",
			list: "åˆ—è¡¨",
			location: "æ‰€åœ¨åœ°",
			city_name: "åŸå¸‚å",
			re_loc: "é‡æ–°å®šä½",
		};
		localString["default"] = {
			and_another: " and ",
			atitude: "Atitude",
			BE: "Buddhist Era ",
			bhumma: "Bhumma",
			budha: "Budha",
			canda: "Canda",
			confirm: "Confirm",
			date: "Date ",
			day: " day(s) ",
			days: " day(s) ",
			departure_in_detail: "departure in detail",
			dhamma_time: "5000 Years of the Buddhaâ€™s Dispensation ",
			eat: "eat",
			gama_entry: "entry the village",
			guru: "Guru",
			hori_ref_time: "horizontal refraction correct ",
			kala: "suitable time",
			language_select: "bhÄsÄ",
			left: "Remains ",
			loading: "loadingâ€¦",
			longitude: "Longitude",
			mÄsa: "mÄsa",
			mins: "(min)",
			month: "Month ",
			month_1: "- ",
			months: " month(s) ",
			my_loc: "attasmiá¹ƒ",
			need_inform: "without informing other Bhikkhu ",
			no_string: "cannot ",
			noon_time: "NOON",
			noon_time: "NOON",
			note: "Note",
			now_time: "NOW",
			pacchÄ_mÄsa: "pacchÄ-mÄsa",
			pakkha: "Lunar Phases ",
			past: "Passed ",
			pubba_mÄsa: "pubba-mÄsa",
			ravi: "Ravi",
			saá¹ƒvacchara: "saá¹ƒvacchara",
			season: "Season ",
			sec: "sec ",
			sora: "Sora",
			sukka: "Sukka",
			sun_height_degree: "Max solar altitude ",
			time: "Time",
			twilight_time: "dawn",
			twilight_time: "dawn",
			vikala: "unsuitable time",
			week_day: "Day",
			year_0: "saá¹ƒvacchara",
			year_1: "- ",
			years: " year(s) ",
			yes_string: "can ",
			timezone: "Timezone",
			local: "local",
			loading: "loading",
			sun_set: "sunset",
			unknown: "unknown",
			altitude: "Altitude",
			today: "today",
			week: "week",
			list: "list",
			location: "location",
			city_name: "city name",
			re_loc: "relocation",
		};
		localString["en"] = {
			and_another: " and ",
			atitude: "Atitude",
			BE: "Buddhist Era ",
			bhumma: "Bhumma",
			budha: "Budha",
			canda: "Canda",
			confirm: "Confirm",
			date: "Date",
			day: " day(s) ",
			days: " day(s) ",
			departure_in_detail: "departure in detail",
			dhamma_time: "5000 Years of the Buddhaâ€™s Dispensation ",
			eat: "eat",
			gama_entry: "entry the village",
			guru: "Guru",
			hori_ref_time: "horizontal refraction correct ",
			kala: "suitable time",
			language_select: "Language",
			left: "Remains ",
			loading: "loadingâ€¦",
			longitude: "Longitude",
			mÄsa: "mÄsa",
			mins: "(min)",
			month: "Month ",
			month_1: "- ",
			months: " month(s) ",
			my_loc: "my location",
			need_inform: "without informing other Bhikkhu ",
			no_string: "cannot ",
			noon_time: "NOON",
			noon_time: "NOON",
			note: "Note",
			now_time: "NOW",
			pacchÄ_mÄsa: "pacchÄ-mÄsa",
			pakkha: "Lunar Phases ",
			past: "Passed ",
			pubba_mÄsa: "pubba-mÄsa",
			ravi: "Ravi",
			saá¹ƒvacchara: "saá¹ƒvacchara",
			season: "Season ",
			sec: "sec",
			sora: "Sora",
			sukka: "Sukka",
			sun_height_degree: "Max solar altitude ",
			time: "time",
			twilight_time: "dawn",
			twilight_time: "dawn",
			vikala: "unsuitable time",
			week_day: "Day",
			year_0: "year",
			year_1: "- ",
			years: " year(s) ",
			yes_string: "can ",
			timezone: "Timezone",
			local: "local",
			loading: "loading",
			sun_set: "sunset",
			unknown: "unknown",
			altitude: "Altitude",
			today: "today",
			week: "week",
			list: "list",
			location: "location",
			city_name: "city name",
			re_loc: "relocation",
		};
		localString["my"] = {
			and_another: " and ",
			atitude: "Atitude",
			BE: "Buddhist Era ",
			bhumma: "á€˜á€¯á€™á€¹á€™",
			budha: "á€—á€¯á€“",
			canda: "á€…á€”á€¹á€’",
			confirm: "Confirm",
			date: "Date ",
			day: " day(s) ",
			days: " day(s) ",
			departure_in_detail: "departure in detail",
			dhamma_time: "5000 Years of the Buddhaâ€™s Dispensation ",
			eat: "eat",
			gama_entry: "entry the village",
			guru: "á€‚á€¯á€›á€¯",
			hori_ref_time: "horizontal refraction correct ",
			kala: "á€€á€¬á€œ",
			language_select: "á€˜á€¬á€á€¬",
			left: "Remains ",
			loading: "loadingâ€¦",
			longitude: "Longitude",
			mÄsa: "á€™á€¬á€",
			mins: "(min)",
			month: "Month ",
			month_1: "- ",
			months: " month(s) ",
			my_loc: "á€¡á€á€¹á€á€á€¹á€™á€­á€¶",
			need_inform: "without informing other Bhikkhu ",
			no_string: "cannot ",
			noon_time: "á€™á€‡á€¹á€ˆá€”á€¹á€Ÿá€­á€€",
			noon_time: "á€™á€‡á€¹á€ˆá€”á€¹á€Ÿá€­á€€",
			note: "Note",
			now_time: "á€•á€…á€¹á€…á€¯á€•á€¹á€•á€”á€¹á€”",
			pacchÄ_mÄsa: "á€•á€…á€¹á€†á€¬-á€™á€¬á€",
			pakkha: "Lunar Phases ",
			past: "Passed ",
			pubba_mÄsa: "á€•á€¯á€—á€¹á€—-á€™á€¬á€",
			ravi: "á€›á€á€­",
			saá¹ƒvacchara: "á€á€¶á€á€…á€¹á€†á€›",
			season: "Season ",
			sec: "sec ",
			sora: "á€á€±á€¬á€›",
			sukka: "á€á€¯á€€á€¹á€€",
			sun_height_degree: "Max solar altitude ",
			time: "Time",
			twilight_time: "á€¡á€›á€¯á€á€¯á€‚á€¹á€‚á€™á€”",
			twilight_time: "á€¡á€›á€¯á€á€¯á€‚á€¹á€‚á€™á€”",
			vikala: "á€á€­á€€á€¬á€œ",
			week_day: "Day",
			year_0: "year",
			year_1: "- ",
			years: " year(s) ",
			yes_string: "can ",
			timezone: "Timezone",
			local: "local",
			loading: "loading",
			sun_set: "sunset",
			unknown: "unknown",
			altitude: "Altitude",
			today: "today",
			week: "week",
			list: "list",
			location: "location",
			city_name: "city name",
			re_loc: "relocation",
		};
		localString["si"] = {
			and_another: " à¶  ",
			atitude: "Atitude",
			BE: "à¶¶à·”à¶¯à·Šà¶° à·€à¶»à·Šà·‚à¶º ",
			bhumma: "à¶·à·”à¶¸à·Šà¶¸",
			budha: "à¶¶à·”à¶°",
			canda: "à¶ à¶±à·Šà¶¯",
			confirm: "Confirm",
			date: "à¶¯à·’à·€à·ƒ ",
			day: " à¶¯à·’à·€à·ƒà·(à¶±à·’) ",
			days: " à¶¯à·’à·€à·ƒà·(à¶±à·’) ",
			departure_in_detail: "departure in detail",
			dhamma_time: "à·ƒà¶¸à·Šà¶¸à· à·ƒà¶¸à·Šà¶¶à·”à¶¯à·Šà¶°à·ƒà·Šà·ƒ à·ƒà·à·ƒà¶±à¶‚ à¶´à¶§à·Šà¶ -à·€à·ƒà·Šà·ƒ-à·ƒà·„à·ƒà·Šà·ƒà·à¶±à·’ à¶´à·€à¶­à·Šà¶­à·’à·ƒà·Šà·ƒà¶­à·’ ",
			eat: "eat",
			gama_entry: "entry the village",
			guru: "à¶œà·”â€à¶»à·”",
			hori_ref_time: "horizontal refraction correct ",
			kala: "à¶šà·à¶½",
			language_select: "à¶·à·à·‚à·à·€",
			left: "à¶…à·€à·ƒà·’à¶§à·Šà¶¨ ",
			loading: "à¶´à·Šâ€à¶»à·€à·šà·à¶±à¶º à·€à·™à¶±à·€à· ",
			longitude: "Longitude",
			mÄsa: "à¶¸à·à·ƒ",
			mins: "(min)",
			month: "à¶¸à·à·ƒ ",
			month_1: "- ",
			months: " à¶¸à·à·ƒà·(à¶±à·’) ",
			my_loc: "à¶…à¶­â€à·Šà¶­à·ƒâ€à·Šà¶¸à·’à¶‚",
			need_inform: "without informing other Bhikkhu ",
			no_string: "cannot ",
			noon_time: "à¶¸à¶¢à·Šà¶£à¶±à·Šà·„à·’à¶š",
			noon_time: "à¶¸à¶¢à·Šà¶£à¶±à·Šà·„à·’à¶š",
			note: "à¶±à·à¶§à·Šà¶§à·”à·€ ",
			now_time: "à¶´à¶ à·Šà¶ à·”à¶´à·Šà¶´à¶±à·Šà¶±",
			pacchÄ_mÄsa: "à¶´à¶ à·Šà¶¡à·-à¶¸à·à·ƒ",
			pakkha: "à¶´à¶šà·Šà¶› ",
			past: "à¶…à¶­à·’à¶šà·Šà¶šà¶±à·Šà¶­ ",
			pubba_mÄsa: "à¶´à·”à¶¶à·Šà¶¶-à¶¸à·à·ƒ",
			ravi: "à¶»à·€à·’",
			saá¹ƒvacchara: "à·ƒà¶‚à·€à¶ à·Šà¶¡â€à¶»",
			season: "à¶‹à¶­à·” ",
			sec: "sec",
			sora: "à·ƒà·œâ€à¶»",
			sukka: "à·ƒà·”à¶šà·Šà¶š",
			sun_height_degree: "Max solar altitude ",
			time: "time",
			twilight_time: "à¶…â€à¶»à·”à¶«à·”à¶œà·Šà¶œà¶¸à¶±",
			twilight_time: "à¶…â€à¶»à·”à¶«à·”à¶œà·Šà¶œà¶¸à¶±",
			vikala: "à·€à·’à¶šà·à¶½",
			week_day: "à·€à·â€à¶» ",
			year_0: "à·ƒà¶‚à·€à¶ à·Šà¶¡â€à¶»",
			year_1: "- ",
			years: " à·ƒà¶‚à·€à¶ à·Šà¶¡â€à¶»à·(à¶±à·’) ",
			yes_string: "can ",
			timezone: "Timezone",
			local: "local",
			loading: "loading",
			sun_set: "sunset",
			unknown: "unknown",
			altitude: "Altitude",
			today: "today",
			week: "week",
			list: "list",
			location: "location",
			city_name: "city name",
			re_loc: "relocation",
		};
		var pali_month_name = [
			{ id: "5", position: 0, value: "assajuja", season: "vassÄna", season_icon: "â˜”" }, //9.X-å…«-åäº”-æ¨“
			{ id: "6", position: 1.25, value: "kattika", season: "vassÄna", season_icon: "â˜”" }, //10.X-ä¹-åäº”-æ˜‚
			{ id: "7", position: 3.5, value: "mÄgasira", season: "hemanta", season_icon: "â„" }, //11.X-å-åäº”-è§œ
			{ id: "8", position: 5.75, value: "phussa", season: "hemanta", season_icon: "â„" }, //12.X-åä¸€-åäº”-é¬¼
			{ id: "9", position: 8, value: "mÄgha", season: "hemanta", season_icon: "â„" }, //1.X-åäºŒ-åäº”-æ˜Ÿ
			{ id: "10", position: 10, value: "phagguna", season: "hemanta", season_icon: "â„" }, //2.X-æ­£æœˆ-åå››ã€åäº”-å¼µã€ç•°
			{ id: "11", position: 12.25, value: "citta", season: "gimhÄna", season_icon: "â˜€" }, //3.X-äºŒæœˆ-åäº”-è§’
			{ id: "12", position: 14.5, value: "vesÄkha", season: "gimhÄna", season_icon: "â˜€" }, //4.X-ä¸‰æœˆ-åäº”-æ°
			{ id: "1", position: 16.75, value: "jeá¹­á¹­ha", season: "gimhÄna", season_icon: "â˜€" }, //5.X-å››-åäº”-å¿ƒ
			{ id: "2", position: 18.75, value: "asÄá¸·ha", season: "gimhÄna", season_icon: "â˜€" }, //6.X-äº”-åäº”ã€åå…­-ç®•ã€æ–—
			{ id: "3", position: 21, value: "sÄvana", season: "vassÄna", season_icon: "â˜”" }, //7.X-å…­-åäº”-å¥³
			{ id: "4", position: 23.5, value: "poá¹­á¹­hapÄda", season: "vassÄna", season_icon: "â˜”" }, //8.x-ä¸ƒ-åäº”ã€åå…­-å®¤ã€å£
			{ id: "5", position: 26, value: "assajuja", season: "vassÄna", season_icon: "â˜”" }, //9.X-å…«-åäº”-æ¨“
		];
		var pali_nakkhatta_name = [
			{ id: "0", value: "assayuja", name_zh: "å¨„å®¿" },//V3
			{ id: "1", value: "bharaá¹‡Ä«", name_zh: "èƒƒå®¿" },
			{ id: "2", value: "KattikÄ", name_zh: "æ˜‚å®¿" },//V4
			{ id: "3", value: "rohiá¹‡Ä«", name_zh: "æ¯•å®¿" },
			{ id: "4", value: "magasira", name_zh: "è§œå®¿" },//H1
			{ id: "5", value: "AddÄ", name_zh: "å‚å®¿" },
			{ id: "6", value: "punabbasu", name_zh: "äº•å®¿" },
			{ id: "7", value: "phussa", name_zh: "é¬¼å®¿" },//H2
			{ id: "8", value: "AsilesÄ", name_zh: "æŸ³å®¿" },
			{ id: "9", value: "maghÄ", name_zh: "æ˜Ÿå®¿" },//H3
			{ id: "10", value: "pubbaphagguá¹‡Ä«", name_zh: "å¼ å®¿" },//H4
			{ id: "11", value: "uttaraphagguá¹‡Ä«", name_zh: "ç¿¼å®¿" },//H4
			{ id: "12", value: "hattha", name_zh: "è½¸å®¿" },
			{ id: "13", value: "cittÄ", name_zh: "è§’å®¿" },//G1
			{ id: "14", value: "sÄti", name_zh: "äº¢å®¿" },
			{ id: "15", value: "visÄkhÄ", name_zh: "æ°å®¿" },//G2
			{ id: "16", value: "anurÄdhÄ", name_zh: "æˆ¿å®¿" },
			{ id: "17", value: "jeá¹­á¹­ha", name_zh: "å¿ƒå®¿" },//G3
			{ id: "18", value: "mÅ«lÄ", name_zh: "å°¾å®¿" },
			{ id: "19", value: "pubbÄsÄá¸·ha", name_zh: "ç®•å®¿" },//G4
			{ id: "20", value: "uttarÄsÄá¸·ha", name_zh: "æ–—å®¿" },//G4
			{ id: "21", value: "savaá¹‡a", name_zh: "å¥³å®¿" },//V1
			{ id: "22", value: "dhaniá¹­á¹­hÄ", name_zh: "è™šå®¿" },
			{ id: "23", value: "satabhisaja", name_zh: "å±å®¿" },
			{ id: "24", value: "pubbabhaddapadÄ", name_zh: "å®¤å®¿" },//V2
			{ id: "25", value: "uttarabhaddapadÄ", name_zh: "å£å®¿" },//V2
			{ id: "26", value: "revatÄ«", name_zh: "å¥å®¿" },
		];
		var horoscope_name = [
			{ id: "0", value: "Aries", name_zh: "ç™½ç¾Š", icon: "â™ˆ" },
			{ id: "1", value: "Taurus", name_zh: "é‡‘ç‰›", icon: "â™‰" },
			{ id: "2", value: "Gemini", name_zh: "åŒå­", icon: "â™Š" },
			{ id: "3", value: "Cancer", name_zh: "å·¨èŸ¹", icon: "â™‹" },
			{ id: "4", value: "Leo", name_zh: "ç‹®å­", icon: "â™Œ" },
			{ id: "5", value: "Virgo", name_zh: "å¤„å¥³", icon: "â™" },
			{ id: "6", value: "Libra", name_zh: "å¤©ç§¤", icon: "â™" },
			{ id: "7", value: "Scorpio", name_zh: "å¤©è", icon: "â™" },
			{ id: "8", value: "Sagittarius", name_zh: "å°„æ‰‹", icon: "â™" },
			{ id: "9", value: "Capricornus", name_zh: "æ‘©ç¾¯", icon: "â™‘" },
			{ id: "10", value: "Aquarius", name_zh: "æ°´ç“¶", icon: "â™’" },
			{ id: "11", value: "Pisces", name_zh: "åŒé±¼", icon: "â™“" },
		];
	</script>
	<script>
		var current_phase = phase();
		console.log(current_phase); //è¾“å‡ºåˆ°æ§åˆ¶å°

		//$("#title_text").html(localString[g_language].BE);
		var new_list = new Array(); //æ–°æœˆåˆ—è¡¨
		var first_list = new Array(); //ä¸Šå¼¦æœˆåˆ—è¡¨
		var full_list = new Array(); //æ»¡æœˆåˆ—è¡¨
		var last_list = new Array(); //ä¸‹å¼¦æœˆåˆ—è¡¨
		var planets = new Array(); //
		var lunar_position = new Object();

		var g_coordinate_this = new Object();
		var g_now_date = new Date();
		var today = new Date();
		var start_day = new Date();
		var next_year = new Date();
		var sun_times = new Object();
		var curr_position = "";
		curr_position = localStorage.getItem("local_position");
		if (curr_position) {
			g_coordinate_this.AT = curr_position.split("#")[0];
			g_coordinate_this.LT = curr_position.split("#")[1];
			g_coordinate_this.height = curr_position.split("#")[2];
			if (g_coordinate_this.AT >= 0) {
				var AT_string = angle_trans(g_coordinate_this.AT)[0] + "Â°" + angle_trans(g_coordinate_this.AT)[1] +
					"â€™" +
					angle_trans(g_coordinate_this.AT)[2] +
					"â€ N";

			} else {
				var AT_string = angle_trans(0 - g_coordinate_this.AT)[0] + "Â°" + angle_trans(0 - g_coordinate_this.AT)[1] +
					"â€™" +
					angle_trans(0 - g_coordinate_this.AT)[2] +
					"â€ S";
			}

			if (g_coordinate_this.LT >= 0) {
				var LT_string = angle_trans(g_coordinate_this.LT)[0] + "Â°" + angle_trans(g_coordinate_this.LT)[1] +
					"â€™" +
					angle_trans(g_coordinate_this.LT)[2] +
					"â€ E";

			} else {
				var LT_string = angle_trans(0 - g_coordinate_this.LT)[0] + "Â°" + angle_trans(0 - g_coordinate_this.LT)[1] +
					"â€™" +
					angle_trans(0 - g_coordinate_this.LT)[2] +
					"â€ W";
			}

			if (g_coordinate_this.height != "null") {
				var height_string = g_coordinate_this.height + "M";
			} else {
				var height_string = localString[g_language].unknown;
			}
		} else {
			getLocation();
		}


		function show_time() {
			if ($("#input_time").val()) {
				today = new Date($("#input_time").val());
			} else {
				today = g_now_date;
			}
			lunar_phase_list_refresh();
			get_position(today);

			let d_earth_to_moon =
				lunar_position.position.x ^
				(2 + lunar_position.position.y) ^
				(2 + lunar_position.position.z) ^
				2 ^
				0.5;
			let d_earth_to_moon_0 = phase(today).distance;

			sun_times = SunCalc.getTimes(
				today,
				g_coordinate_this.AT,
				g_coordinate_this.LT,
				g_coordinate_this.height / 1000
			);
			sun_position = SunCalc.getPosition(today, g_coordinate_this.AT, g_coordinate_this.LT);
			moon_position = SunCalc.getMoonPosition(today, g_coordinate_this.AT, g_coordinate_this.LT);
			moon_Illumination = SunCalc.getMoonIllumination(today);
		}
		//æ ¹æ®æ—¶é—´è®¡ç®—åè§’ï¼Œè¾“å‡º
		function get_position(date_time) {
			let planets_position = new Object();
			planets = window.lagrange.planet_positions.getPositions(date_time);
			//planets = global.planet_positions.getPositions(today);
			//console.log(planets)//è¾“å‡ºåˆ°æ§åˆ¶å°
			earth_position = window.lagrange.planet_positions.getPositions(date_time)[3];
			lunar_position = window.lagrange.planet_positions.getPositions(date_time)[11];
			let lunar_position_angle = 0;
			let lunar_station = 0;
			let earth_position_angle = 0;
			let earth_station = 0;
			let earth_position_angle_round = 0;
			let lunar_position_angle_round = 0;
			//å¤ªé˜³ç›¸å¯¹åœ°çƒçš„é»„é“åè§’
			if (earth_position.position.y >= 0) {
				earth_position_angle = Math.atan2(earth_position.position.y, earth_position.position.x);
			} else {
				earth_position_angle =
					Math.PI * 2 + Math.atan2(earth_position.position.y, earth_position.position.x);
			}
			earth_position_angle_round = earth_position_angle / Math.PI / 2 + 0.5;
			earth_position_angle_round = earth_position_angle_round - Math.floor(earth_position_angle_round);
			earth_station = earth_position_angle_round * 12;
			planets_position.solar_station = earth_station;
			planets_position.solar_position_angle = earth_position_angle_round * Math.PI * 2;
			planets_position.solar_position_angle_round = earth_position_angle_round;
			//æœˆçƒç›¸å¯¹åœ°çƒçš„é»„é“åè§’â€”â€”è§’åº¦å·®ç®—æ³•
			lunar_position_angle_round = earth_position_angle_round + phase(date_time).phase;
			lunar_position_angle_round = lunar_position_angle_round - Math.floor(lunar_position_angle_round);
			lunar_position_angle = lunar_position_angle_round * Math.PI * 2;
			lunar_station = lunar_position_angle_round * 27;
			//æœˆçƒç›¸å¯¹åœ°çƒçš„é»„é“åè§’ç®—æ³•â€”â€”å‘é‡å·®ç®—æ³•
			let lunar_to_earth = new Object();
			lunar_to_earth.y = lunar_position.position.y - earth_position.position.y;
			lunar_to_earth.x = lunar_position.position.x - earth_position.position.x;
			if (lunar_to_earth.y >= 0) {
				lunar_position_angle2 = Math.atan2(lunar_to_earth.y, lunar_to_earth.x);
			} else {
				lunar_position_angle2 = Math.PI * 2 + Math.atan2(lunar_to_earth.y, lunar_to_earth.x);
			}
			lunar_position_angle_round2 = lunar_position_angle2 / Math.PI / 2;
			//lunar_position_angle_round = lunar_position_angle_round - Math.floor(lunar_position_angle_round)
			lunar_position_angle2 = lunar_position_angle_round2 * Math.PI * 2;

			lunar_station2 = lunar_position_angle_round2 * 27;

			planets_position.lunar_station = lunar_station; //æœˆç«™å€¼ã€è§’åº¦å·®ç®—å¤¹è§’ã€‘
			planets_position.lunar_position_angle = lunar_position_angle; //æœˆç«™è§’ã€è§’åº¦å·®ç®—å¤¹è§’ã€‘
			planets_position.lunar_position_angle_round = lunar_position_angle_round; //æœˆç«™åœ†å‘¨æ¯”ç‡ã€è§’åº¦å·®ç®—å¤¹è§’ã€‘
			planets_position.lunar_station2 = lunar_station2; //æœˆç«™å€¼ã€çŸ¢é‡å·®ç®—å¤¹è§’ã€‘
			planets_position.lunar_position_angle2 = lunar_position_angle2; //æœˆç«™è§’ã€çŸ¢é‡å·®ç®—å¤¹è§’ã€‘
			planets_position.lunar_position_angle_round2 = lunar_position_angle_round2; //æœˆç«™åœ†å‘¨æ¯”ç‡ã€çŸ¢é‡å·®ç®—å¤¹è§’ã€‘
			return planets_position;
		}
		//æ ¹æ®;
		function get_station_name(data_time) {
			//è·å–æ˜Ÿè±¡ä¿¡æ¯
			var x_m = 0;
			let solar_num = 0;
			let lunar_num = 0;
			let result = new Object();
			solar_num = get_position(data_time).solar_station;
			solar_num = Math.floor(solar_num);
			lunar_num = get_position(data_time).lunar_station;
			next_month = new Date()
			next_month.setDate(data_time.getDate() + 30)
			lunar_month_num = get_position(phaseRange(data_time, next_month, FULL)[0]).lunar_station
			for (x_m in pali_month_name) {
				if (lunar_month_num > pali_month_name[x_m].position && lunar_month_num < pali_month_name[Number(x_m) + 1].position) {
					result.month_name = pali_month_name[x_m]
					break;
				} else if (lunar_month_num < 1.25 || lunar_month_num >= 26) {
					result.month_name = pali_month_name[0]
					break;
				}

			}
			lunar_num = Math.floor(lunar_num);

			result.solar = horoscope_name[solar_num]; //é»„é“åäºŒå®«æ˜Ÿè±¡åç§°
			result.lunar = pali_nakkhatta_name[lunar_num]; //27æ˜Ÿå®¿æœˆç«™åç§°
			result.nextfullmoon = phaseRange(data_time, next_month, FULL)[0]
			return result;
		}
		function show_position() {
			curr_position = localStorage.getItem("local_position");
			if (curr_position) {
				g_coordinate_this.AT = curr_position.split("#")[0];
				g_coordinate_this.LT = curr_position.split("#")[1];
				g_coordinate_this.height = curr_position.split("#")[2];
				if (g_coordinate_this.AT >= 0) {
					var AT_string = angle_trans(g_coordinate_this.AT).str;

				} else {
					var AT_string = angle_trans(0 - g_coordinate_this.AT).str;
				}

				if (g_coordinate_this.LT >= 0) {
					var LT_string = angle_trans(g_coordinate_this.LT).str;

				} else {
					var LT_string = angle_trans(0 - g_coordinate_this.LT).str;
				}

				if (g_coordinate_this.height != "null") {
					var height_string = g_coordinate_this.height + "M";
				} else {
					var height_string = localString[g_language].unknown;
				}
			} else {
				getLocation();
			}
			$("#AT_str").html(AT_string);
			$("#LT_str").html(LT_string);
			$("#altitude_string").html(height_string);
			if (g_coordinate_this.AT < 0) {
				$("#AT_Â°")[0].value = angle_trans(0 - g_coordinate_this.AT).d;
				$("#AT_â€™")[0].value = angle_trans(0 - g_coordinate_this.AT).m;
				$("#AT_â€")[0].value = angle_trans(0 - g_coordinate_this.AT).s;
				$("#NS")[0].value = "-";
			}
			else {
				$("#AT_Â°")[0].value = angle_trans(g_coordinate_this.AT).d;
				$("#AT_â€™")[0].value = angle_trans(g_coordinate_this.AT).m;
				$("#AT_â€")[0].value = angle_trans(g_coordinate_this.AT).s;
				$("#NS")[0].value = "+";

			}
			if (g_coordinate_this.LT < 0) {
				$("#LT_Â°")[0].value = angle_trans(0 - g_coordinate_this.LT).d;
				$("#LT_â€™")[0].value = angle_trans(0 - g_coordinate_this.LT).m;
				$("#LT_â€")[0].value = angle_trans(0 - g_coordinate_this.LT).s;
				$("#WE")[0].value = "-";

			}
			else {
				$("#LT_Â°")[0].value = angle_trans(g_coordinate_this.LT).d;
				$("#LT_â€™")[0].value = angle_trans(g_coordinate_this.LT).m;
				$("#LT_â€")[0].value = angle_trans(g_coordinate_this.LT).s;
				$("#WE")[0].value = "+";
			}
			$("#HT_M")[0].value = g_coordinate_this.height;
			$("#city_str").html(find_city(g_coordinate_this.AT, g_coordinate_this.LT).name);
		}

		//show_position();
		function getLocation() {
			//è‡ªåŠ¨å®šä½
			if (navigator.geolocation) {
				navigator.geolocation.getCurrentPosition(showPosition, showError);
			} else {
				$("#selected_position_string").html("Geolocation is not supported by this browser.");
			}
		}
		function showPosition(position) {
			alert("get cordinate success");
			g_coordinate_this.AT = position.coords.latitude; //çº¬åº¦
			g_coordinate_this.LT = position.coords.longitude; //ç»åº¦
			g_coordinate_this.height = position.coords.altitude; //æµ·æ‹”é«˜åº¦

			let position_string = g_coordinate_this.AT + "#" + g_coordinate_this.LT + "#" + g_coordinate_this.height;
			localStorage.setItem("local_position", position_string);

		}

		function position_input() {
			//æ‰‹åŠ¨è¾“å…¥
			var LT = Number($("#LT_Â°")[0].value);
			LT += Number($("#LT_â€™")[0].value) / 60;
			LT += Number($("#LT_â€")[0].value) / 3600;
			LT = Number($("#WE")[0].value + LT);
			var AT = Number($("#AT_Â°")[0].value);
			AT += Number($("#AT_â€™")[0].value) / 60;
			AT += Number($("#AT_â€")[0].value) / 3600;
			AT = Number($("#NS")[0].value + AT);
			if (AT != 0) {
				g_coordinate_this.LT = LT;
				g_coordinate_this.AT = AT;
			}
		}
		function showError(error) {
			switch (error.code) {
				case error.PERMISSION_DENIED:
					alert("å®šä½å¤±è´¥,ç”¨æˆ·æ‹’ç»è¯·æ±‚åœ°ç†å®šä½");
					break;
				case error.POSITION_UNAVAILABLE:
					alert("å®šä½å¤±è´¥,ä½ç½®ä¿¡æ¯æ˜¯ä¸å¯ç”¨");
					break;
				case error.TIMEOUT:
					alert("å®šä½å¤±è´¥,è¯·æ±‚è·å–ç”¨æˆ·ä½ç½®è¶…æ—¶");
					break;
				case error.UNKNOWN_ERROR:
					alert("å®šä½å¤±è´¥,å®šä½ç³»ç»Ÿå¤±æ•ˆ");
					break;
			}
		}
		function angle_trans(angle, type) {
			var angle_str = new Object;
			if (type == "L") {
				if (angle >= 0) {
					angle_str.suf = "E";
				} else {
					angle_str.suf = "W";
				}
			}
			else {
				if (angle >= 0) {
					angle_str.suf = "N";
				} else {
					angle_str.suf = "S";
				}
			}
			angle = Math.abs(angle);
			angle_str.d = Math.floor(angle);
			angle_str.m = Math.floor((angle - angle_str.d) * 60);
			angle_str.s = Math.round((angle - angle_str.d) * 60 - angle_str.m);

			angle_str.str = angle_str.d + "Â°" + angle_str.m + "â€™" + angle_str.s + "â€" + angle_str.suf;

			return angle_str;
		}
		function input_position() {
			$("#position_input").show();
		}
		var g_event_list_arr = new Array();
		function get_event_arr() {
			let today = new Date();
			let date = new Date();
			for (i = -360; i < 360; i++) {
				date.setTime(today.getTime() + i * 3600 * 24 * 1000);
				let info_obj = new Object();
				info_obj.id = "dawn" + i;
				info_obj.title = "ğŸŒ†" + localString[g_language].twilight_time;
				info_obj.start = SunCalc.getTimes(
					date,
					g_coordinate_this.AT,
					g_coordinate_this.LT,
					g_coordinate_this.height / 1000
				).dawn;
				g_event_list_arr.push(info_obj);

				info_obj = new Object();
				info_obj.id = "noon" + i;
				info_obj.title = "ğŸŒ" + localString[g_language].noon_time;
				info_obj.start = SunCalc.getTimes(
					date,
					g_coordinate_this.AT,
					g_coordinate_this.LT,
					g_coordinate_this.height / 1000
				).solarNoon;

				g_event_list_arr.push(info_obj);
				info_obj = new Object();
				info_obj.id = "sunset" + i;
				info_obj.title = "ğŸŒ‡" + localString[g_language].sun_set;
				info_obj.start = SunCalc.getTimes(
					date,
					g_coordinate_this.AT,
					g_coordinate_this.LT,
					g_coordinate_this.height / 1000
				).sunset;
				g_event_list_arr.push(info_obj);
			}

			next_year.setDate(start_day.getDate() + 360);
			start_day.setDate(today.getDate() - 360);
			last_list = phaseRange(start_day, next_year, LAST); //è·å–ä¸‹å¼¦æœˆåˆ—è¡¨
			for (i_last in last_list) {
				info_obj = new Object();
				info_obj.id = "last_moon" + i_last;
				info_obj.title = "ğŸŒ—" + get_station_name(last_list[i_last]).lunar.value;
				info_obj.start = last_list[i_last];
				g_event_list_arr.push(info_obj);
			}
			new_list = phaseRange(start_day, next_year, NEW); //è·å–æ–°æœˆåˆ—è¡¨
			for (i_new in new_list) {
				info_obj = new Object();
				info_obj.id = "new_moon" + i_new;
				info_obj.title = "ğŸŒ‘" + get_station_name(new_list[i_new]).lunar.value;
				info_obj.start = new_list[i_new];
				g_event_list_arr.push(info_obj);
			}
			first_list = phaseRange(start_day, next_year, FIRST); //è·å–ä¸Šå¼¦æœˆåˆ—è¡¨
			for (i_first in first_list) {
				info_obj = new Object();
				info_obj.id = "first_moon" + i_first;
				info_obj.title = "ğŸŒ“" + get_station_name(first_list[i_first]).lunar.value;
				info_obj.start = first_list[i_first];
				g_event_list_arr.push(info_obj);
			}
			full_list = phaseRange(start_day, next_year, FULL); //è·å–æ»¡æœˆåˆ—è¡¨
			for (i_full in full_list) {
				info_obj = new Object();
				info_obj.id = "full_moon" + i_full;
				info_obj.title = "ğŸŒ•@" + get_station_name(full_list[i_full]).lunar.value + "ğŸŒŸ";
				info_obj.start = full_list[i_full];
				g_event_list_arr.push(info_obj);

				info_obj = new Object();
				info_obj.id = "month" + i_full;
				info_obj.title = get_station_name(full_list[i_full]).month_name.value + localString[g_language].month;
				info_obj.start = full_list[i_full];
				g_event_list_arr.push(info_obj);
			}

			/*console.log(last_list); //è¾“å‡ºåˆ°æ§åˆ¶å°
			console.log(new_list); //è¾“å‡ºåˆ°æ§åˆ¶å°
			console.log(first_list); //è¾“å‡ºåˆ°æ§åˆ¶å°
			console.log(full_list); //è¾“å‡ºåˆ°æ§åˆ¶å°*/
		}
		get_event_arr();
	</script>
	<script src="../lib/main.js"></script>
	<script>
		function getCookie(name) {
			var start = document.cookie.indexOf(name + "=");
			var len = start + name.length + 1;
			if (!start && name != document.cookie.substring(0, name.length)) {
				return null;
			}
			if (start == -1) return null;
			var end = document.cookie.indexOf(";", len);
			if (end == -1) end = document.cookie.length;
			return decodeURI(document.cookie.substring(len, end));
		}

		document.addEventListener("DOMContentLoaded", function () {
			var initialTimeZone = "local";
			var timeZoneSelectorEl = document.getElementById("time-zone-selector");
			var loadingEl = document.getElementById("loading");
			var calendarEl = document.getElementById("calendar");

			var calendar = new FullCalendar.Calendar(calendarEl, {
				timeZone: initialTimeZone,
				locale: getCookie("language"),
				headerToolbar: {
					left: "prev,next today",
					center: "title",
					right: "dayGridMonth,timeGridWeek,timeGridDay,listWeek",
				},
				//initialDate: "2020-12-12",
				navLinks: true, // can click day/week names to navigate views
				editable: true,
				selectable: true,
				dayMaxEvents: true, // allow "more" link when too many events
				//resources: g_event_list_arr,
				events: g_event_list_arr,
				defaultTimedEventDuration: "00:01",
				eventClick: function (info) {
					info.jsEvent.preventDefault(); // don't let the browser navigate

					if (info.event.url) {
						window.open(info.event.url);
					}
				},
				loading: function (bool) {
					if (bool) {
						loadingEl.style.display = "inline"; // show
					} else {
						loadingEl.style.display = "none"; // hide
					}
				},

				eventTimeFormat: { hour: "numeric", minute: "2-digit" },
				dateClick: function (arg) {
					console.log("dateClick", calendar.formatIso(arg.date));
				},
				select: function (arg) {
					console.log("select", calendar.formatIso(arg.start), calendar.formatIso(arg.end));
				},
			});

			calendar.render();
			// load the list of available timezones, build the <select> options
			// it's HIGHLY recommended to use a different library for network requests, not this internal util func
			FullCalendar.requestJson(
				"GET",
				"php/get-time-zones.php",
				{},
				function (timeZones) {
					timeZones.forEach(function (timeZone) {
						var optionEl;

						if (timeZone !== "UTC") {
							// UTC is already in the list
							optionEl = document.createElement("option");
							optionEl.value = timeZone;
							optionEl.innerText = timeZone;
							timeZoneSelectorEl.appendChild(optionEl);
						}
					});
				},
				function () {
					// TODO: handle error
				}
			);

			// when the timezone selector changes, dynamically change the calendar option
			timeZoneSelectorEl.addEventListener("change", function () {
				calendar.setOption("timeZone", this.value);
			});
		});
	</script>
	<style>
		body {
			margin: 0;
			padding: 0;
			font-family: Arial, Helvetica Neue, Helvetica, sans-serif;
			font-size: 14px;
		}

		#top {
			background: #eee;
			border-bottom: 1px solid #ddd;
			padding: 0 10px;
			line-height: 40px;
			font-size: 12px;
		}

		.left {
			float: left;
		}

		.right {
			float: right;
		}

		.clear {
			clear: both;
		}

		#script-warning,
		#loading {
			display: none;
		}

		#script-warning {
			font-weight: bold;
			color: red;
		}

		#calendar {
			max-width: 1100px;
			margin: 40px auto;
			padding: 0 10px;
		}

		.tzo {
			color: #000;
		}

		input[type="number"i] {
			width: 2.5em;
		}
	</style>
</head>

<body>
	<title id="page_title"></title>
	<div id="top" style="display: inline-flex;width: 100vw;">
		<div class="left" style="display: inline-flex;height: 5vh;margin: auto 1em;">
			<span style="white-space: nowrap;max-height: 5vh;white-space: nowrap;margin: auto 0;">
				<script>
					document.write(localString[g_language].timezone + "ï¼š");
					$("#page_title").html(localString[g_language].BE);
				</script>
			</span>
			<select id="time-zone-selector" style="max-height: 5vh;height: fit-content;margin: auto 0;">
				<option value="local" selected>
					<script>
						document.write(localString[g_language].local);
					</script>
				</option>
				<option value="UTC">UTC</option>
			</select>
		</div>
		<div style="display: inline-block;margin-left:5%; justify-content: center; width: 25em">
			<div style="line-height: 2em; margin-top: 7px">
				<script>
					document.write(localString[g_language].atitude);
				</script>
				<span id="AT_str" onclick="show_ele(this)">âœ</span>
				<span class="coordinate_input" style="flex: 7; white-space: nowrap; display: none">
					<input id="AT_Â°" type="number" min="0" max="89" /> Â°
					<input id="AT_â€™" type="number" min="0" max="59" /> â€™
					<input id="AT_â€" type="number" min="0" max="59" /> â€
					<select id="NS">
						<option value="+">N</option>
						<option value="-">S</option>
					</select>
					<button onclick="coordinate_confirm('AT')">
						<script>
							document.write(localString[g_language].confirm);
						</script>
					</button>
				</span>
			</div>
			<div style="line-height: 2em">
				<script>
					document.write(localString[g_language].longitude);
				</script>
				<span id="LT_str" onclick="show_ele(this)">âœ</span>
				<span class="coordinate_input" onblur="show_ele(this)"
					style="flex: 7; white-space: nowrap; display: none">
					<input id="LT_Â°" type="number" min="0" max="179" style="width: 3em" /> Â°
					<input id="LT_â€™" type="number" min="0" max="59" /> â€™
					<input id="LT_â€" type="number" min="0" max="59" /> â€
					<select id="WE">
						<option value="+">E</option>
						<option value="-">W</option>
					</select>
					<button onclick="coordinate_confirm('LT')">
						<script>
							document.write(localString[g_language].confirm);
						</script>
					</button>
				</span>
			</div>
			<div style="line-height: 2em">
				<script>
					document.write(localString[g_language].altitude);
				</script>
				<span id="altitude_string" onclick="show_ele(this)"></span>
				<span class="coordinate_input" style="flex: 7; white-space: nowrap; display: none">
					<input id="HT_M" type="number" min="0" max="19999" style="width: 4em" /> M
					<button onclick="coordinate_confirm('HT')">
						<script>
							document.write(localString[g_language].confirm);
						</script>
					</button>
				</span>
			</div>
		</div>
		<div style="display: inline-block; width: 50%; justify-content: center;">
			<script>
				document.write(localString[g_language].location);
			</script>
			<span id="city_str" onclick=""></span>
			<button id="re_loc" onclick="getLocation()">
				<script>
					document.write(localString[g_language].re_loc);
				</script>
			</button>
			<span id="city_info"></span>
			<input class="cityinput" id="citySelect" value="" style="display: none;">
			<div class="citySelector" style="position: absolute; left: 8px; top: 25.6px; z-index: 999999;">
				<div class="cityBox hide" id="cityBox"></div>
			</div>


		</div>
		<div style="display: inline-block; width: 50%; justify-content: center;">
			<script>
				//document.write(localString[g_language].location);
				document.write("å•æ—¥æŸ¥è¯¢ï¼š");
				function set_date_info(date_time_element){
					var date_info = new Object();
					date_info = get_station_name(new Date(date_time_element.value))
					let string="";
					string += "åœ¨" + date_info.month_name.season_icon + date_info.month_name.season + "çš„" + date_info.month_name.value + "æœˆ";
					string +=  "<br>æœˆäº®æ˜Ÿå®¿ï¼š" + date_info.lunar.value + date_info.lunar.name_zh + "<br>";
					string += "å¤ªé˜³æ˜Ÿå®¿ï¼š" + date_info.solar.value + date_info.solar.name_zh;
					string += "<br>æœˆåœ†æ—¶é—´ï¼š" + date_info.nextfullmoon.toLocaleString()
					$("#date_info_indetal").html(string)
				}
			</script>
			<input type="datetime-local" id="input_date" onblur="set_date_info(this)" style="display: block;">
			<span id="date_info_indetal" ></span>


		</div>
		<div class="right">
			<span id="loading">
				<script>
					document.write(localString[g_language].loading + "â€¦");
				</script>
			</span>
			<span id="script-warning"><code>php/get-events.php</code> must be running.</span>
		</div>

		<div class="clear"></div>
	</div>

	<div id="calendar"></div>
</body>
<script>
	$("#citySelect")[0].value = localString[g_language].city_name;
	function position_modify() {
		var LT = Number($("#LT_Â°")[0].value);
		LT += Number($("#LT_â€™")[0].value) / 60;
		LT += Number($("#LT_â€")[0].value) / 3600;
		LT = Number($("#WE")[0].value + LT);
		var AT = Number($("#AT_Â°")[0].value);
		AT += Number($("#AT_â€™")[0].value) / 60;
		AT += Number($("#AT_â€")[0].value) / 3600;
		AT = Number($("#NS")[0].value + AT);
		if (AT != 0 || LT != 0) {
			g_coordinate_this.LT = LT;
			g_coordinate_this.AT = AT;
		}
		g_coordinate_this.height = Number($("#HT_M")[0].value);
		//å°†æ–°çš„åæ ‡æ•°æ®å­˜åˆ°localStorage
		let position_string = g_coordinate_this.AT + "#" + g_coordinate_this.LT + "#" + g_coordinate_this.height;
		localStorage.setItem("local_position", position_string);
		show_position();
	}
	function position_modify_confirm(obj) {
		position_modify();

		show_ele(obj);
	}
	function show_ele(obj) {
		if ($(obj).siblings("span").css("display") == "none") {
			$(obj).hide();
			$(obj).siblings("span").show();
		} else {
			$(obj).show();
			$(obj).siblings("span").hide();
		}
	}
	function getLocation() {
		//è‡ªåŠ¨å®šä½
		if (navigator.geolocation) {
			navigator.geolocation.getCurrentPosition(showPosition, showError);
		} else {
			$("#selected_position_string").html("Geolocation is not supported by this browser.");
		}
	}
	function showPosition(position) {
		alert("get cordinate success");
		g_coordinate_this.AT = position.coords.latitude; //çº¬åº¦
		g_coordinate_this.LT = position.coords.longitude; //ç»åº¦
		g_coordinate_this.height = position.coords.altitude; //æµ·æ‹”é«˜åº¦
	}

	function position_input() {
		//æ‰‹åŠ¨è¾“å…¥
		var LT = Number($("#LT_Â°")[0].value);
		LT += Number($("#LT_â€™")[0].value) / 60;
		LT += Number($("#LT_â€")[0].value) / 3600;
		LT = Number($("#WE")[0].value + LT);
		var AT = Number($("#AT_Â°")[0].value);
		AT += Number($("#AT_â€™")[0].value) / 60;
		AT += Number($("#AT_â€")[0].value) / 3600;
		AT = Number($("#NS")[0].value + AT);
		if (AT != 0) {
			g_coordinate_this.LT = LT;
			g_coordinate_this.AT = AT;
		}
	}
	function showError(error) {
		switch (error.code) {
			case error.PERMISSION_DENIED:
				alert("å®šä½å¤±è´¥,ç”¨æˆ·æ‹’ç»è¯·æ±‚åœ°ç†å®šä½");
				break;
			case error.POSITION_UNAVAILABLE:
				alert("å®šä½å¤±è´¥,ä½ç½®ä¿¡æ¯æ˜¯ä¸å¯ç”¨");
				break;
			case error.TIMEOUT:
				alert("å®šä½å¤±è´¥,è¯·æ±‚è·å–ç”¨æˆ·ä½ç½®è¶…æ—¶");
				break;
			case error.UNKNOWN_ERROR:
				alert("å®šä½å¤±è´¥,å®šä½ç³»ç»Ÿå¤±æ•ˆ");
				break;
		}
	}
	function coordinate_confirm(type) {
		switch (type) {
			case "AT":
				show_ele('#AT_str');
				break;
			case "LT":
				show_ele('#LT_str');
				break;
			case "HT":
				show_ele('#altitude_string');
				break;
		}
		position_modify();
	}
	function show_position() {
		curr_position = localStorage.getItem("local_position");
		if (curr_position) {
			g_coordinate_this.AT = curr_position.split("#")[0];
			g_coordinate_this.LT = curr_position.split("#")[1];
			g_coordinate_this.height = curr_position.split("#")[2];
			if (g_coordinate_this.AT >= 0) {
				var AT_string = angle_trans(g_coordinate_this.AT).str;

			} else {
				var AT_string = angle_trans(0 - g_coordinate_this.AT).str;
			}

			if (g_coordinate_this.LT >= 0) {
				var LT_string = angle_trans(g_coordinate_this.LT).str;

			} else {
				var LT_string = angle_trans(0 - g_coordinate_this.LT).str;
			}

			if (g_coordinate_this.height != "null") {
				var height_string = g_coordinate_this.height + "M";
			} else {
				var height_string = localString[g_language].unknown;
			}
		} else {
			getLocation();
		}
		$("#AT_str").html(AT_string);
		$("#LT_str").html(LT_string);
		$("#altitude_string").html(height_string);
		if (g_coordinate_this.AT < 0) {
			$("#AT_Â°")[0].value = angle_trans(0 - g_coordinate_this.AT).d;
			$("#AT_â€™")[0].value = angle_trans(0 - g_coordinate_this.AT).m;
			$("#AT_â€")[0].value = angle_trans(0 - g_coordinate_this.AT).s;
			$("#NS")[0].value = "-";
		}
		else {
			$("#AT_Â°")[0].value = angle_trans(g_coordinate_this.AT).d;
			$("#AT_â€™")[0].value = angle_trans(g_coordinate_this.AT).m;
			$("#AT_â€")[0].value = angle_trans(g_coordinate_this.AT).s;
			$("#NS")[0].value = "+";

		}
		if (g_coordinate_this.LT < 0) {
			$("#LT_Â°")[0].value = angle_trans(0 - g_coordinate_this.LT).d;
			$("#LT_â€™")[0].value = angle_trans(0 - g_coordinate_this.LT).m;
			$("#LT_â€")[0].value = angle_trans(0 - g_coordinate_this.LT).s;
			$("#WE")[0].value = "-";

		}
		else {
			$("#LT_Â°")[0].value = angle_trans(g_coordinate_this.LT).d;
			$("#LT_â€™")[0].value = angle_trans(g_coordinate_this.LT).m;
			$("#LT_â€")[0].value = angle_trans(g_coordinate_this.LT).s;
			$("#WE")[0].value = "+";
		}
		$("#HT_M")[0].value = g_coordinate_this.height;
		$("#city_str").html(find_city(g_coordinate_this.AT, g_coordinate_this.LT).name);
	}

	show_position();


	$(document).ready(function () {
		$("button").each(function () {
			if ($(this).html() == "today") {
				$(this).html(localString[g_language].today);
			}
			if ($(this).html() == "list") {
				$(this).html(localString[g_language].list);
			}
			if ($(this).html() == "week") {
				$(this).html(localString[g_language].week);
			}
			if ($(this).html() == "month") {
				$(this).html(localString[g_language].month);
			}
			if ($(this).html() == "day") {
				$(this).html(localString[g_language].day);
			}
		});
	});
	$(document).ready(function () {
		$("button").click(function () {
			$("button").each(function () {
				if ($(this).html().indexOf("today") != -1) {
					$(this).html(localString[g_language].today);
				}
				if ($(this).html().indexOf("list") != -1) {
					$(this).html(localString[g_language].list);
				}
				if ($(this).html().indexOf("week") != -1) {
					$(this).html(localString[g_language].week);
				}
				if ($(this).html().indexOf("month") != -1) {
					$(this).html(localString[g_language].month);
				}
				if ($(this).html().indexOf("day") != -1 && $(this).html().indexOf("today") == -1) {
					$(this).html(localString[g_language].day);
				}
			});
		});
	});

	$(document).ready(function () {
		$("div").click(function () {
			$("button").each(function () {
				if ($(this).html().indexOf("today") != -1) {
					$(this).html(localString[g_language].today);
				}
				if ($(this).html().indexOf("list") != -1) {
					$(this).html(localString[g_language].list);
				}
				if ($(this).html().indexOf("week") != -1) {
					$(this).html(localString[g_language].week);
				}
				if ($(this).html().indexOf("month") != -1) {
					$(this).html(localString[g_language].month);
				}
				if ($(this).html().indexOf("day") != -1 && $(this).html().indexOf("today") == -1) {
					$(this).html(localString[g_language].day);
				}
			});
		});
	});
	//ç»™å‡ºä¸¤ä¸ªç»çº¬åº¦åæ ‡ç›´æ¥çš„è·ç¦»
	function distance(x, y) {
		var toRadians = function (num) {
			return num * Math.PI / 180;
		};
		var lat1 = x.latitude;
		var lon1 = x.longitude;
		var lat2 = y.latitude;
		var lon2 = y.longitude;

		var R = 6371; // km
		var Ï†1 = toRadians(lat1);//çº¬åº¦å¼§åº¦1
		var Ï†2 = toRadians(lat2);//çº¬åº¦å¼§åº¦2
		var Î”Ï† = toRadians(lat2 - lat1);//çº¬åº¦å¼§åº¦å·®
		var Î”Î» = toRadians(lon2 - lon1);//ç»åº¦å¼§åº¦å·®
		var a = Math.sin(Î”Ï† / 2) * Math.sin(Î”Ï† / 2) +
			Math.cos(Ï†1) * Math.cos(Ï†2) *
			Math.sin(Î”Î» / 2) * Math.sin(Î”Î» / 2);
		var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
		return R * c;
	}
	function find_city(latitude, longitude) {
		var point = new Object;
		var point_X = new Object;
		var city_info = new Object;
		var min_S = 10000
		point.latitude = latitude;
		point.longitude = longitude;
		for (i in city_list) {
			point_X.latitude = city_list[i].latitude;
			point_X.longitude = city_list[i].longitude;
			if (distance(point, point_X) < min_S) {
				city_info = city_list[i];
				min_S = distance(point, point_X);
			}
		}
		if (min_S == 10000) {
			city_info.name = localString[g_language].unknown;
			city_info.asciiName = localString[g_language].unknown;
		}
		return (city_info);
	}

</script>
<style type="text/css">
	.demo {
		width: 220px;
		margin: 20px auto;
	}


	/* citySelector */
	.citySelector {
		font: 12px/1.5 tahoma, arial, \5b8b\4f53;
		background: #fff;
		text-align: left;
	}

	.cityslide {
		width: 250px;
		list-style: none;
		margin: 0;
		padding: 0;
		border: 1px solid #85BEE5;
		border-right-color: #3485C0;
		border-bottom-color: #3485C0;
		box-shadow: 2px 2px 3px rgba(0, 0, 0, 0.3);
		margin-top: -2px;
	}

	.cityslide li {
		list-style: none;
		overflow: hidden;
		height: 16px;
		padding: 4px 5px;
	}

	.cityslide li.on {
		background: #9CD9FF;
		color: #fff;
	}

	.cityslide li b {
		font-weight: normal;
	}

	.cityslide li.empty {
		background: #fff2e8;
		color: #666;
	}

	.cityslide li.empty em {
		color: red;
		font-style: normal;
	}

	.cityname {
		float: left;
	}

	.cityspell {
		float: right;
	}

	.cityBox {
		width: 320px;
		border: 1px solid #85BEE5;
		overflow: hidden;
		box-shadow: 2px 2px 3px rgba(0, 0, 0, 0.3);
	}

	.cityBox ul {
		margin: 0;
		padding: 0;
		overflow: hidden;
	}

	.cityBox ul li {
		float: left;
		list-style: none;
		padding: 2px 4px;
		border: 1px solid #85BEE5;
		cursor: pointer;
		margin-left: 4px;
		display: inline;
		background: #E1EFFE;
	}

	.cityBox ul li.on {
		background: #fff;
		border-bottom-color: #fff;
		position: relative;
	}

	.hide {
		display: none;
	}

	p.tip {
		color: #666;
		line-height: 20px;
		padding: 5px;
		margin: 0;
		text-indent: 3px;
	}

	.hotCity {
		border-top: 1px solid #85BEE5;
		margin-top: -1px;
		clear: left;
		overflow: hidden;
		padding-bottom: 5px;
		padding-top: 5px;
		_margin-bottom: 8px;
	}

	.cityTab {
		overflow: hidden;
	}

	.cityTab dl {
		margin: 0;
		padding: 0;
		overflow: hidden;
	}

	.cityTab dl dt {
		float: left;
		padding-left: 3px;
		color: #F30;
		text-indent: 5px;
		font-family: "Lucida console", "consolas", "courier new";
		line-height: 22px;
		font-size: 14px;
		width: 20px;
	}

	.cityTab dl dd {
		margin-left: 2px;
		float: left;
		width: 290px;
	}

	.cityTab dl dd a {
		padding-left: 5px;
		width: 66px;
		line-height: 22px;
		display: inline-block;
		color: #000;
		text-decoration: none;
	}

	.cityTab dl dd a:hover {
		text-decoration: underline;
		color: red
	}

	.cityinput {
		font-size: 12px;
		padding-left: 2px;
		background: url(T1EPyLXm0hXXXXXXXX-200-100.png) no-repeat 150px 5px;
		border: 1px solid #D8D8D8;
	}
</style>
<script type="text/javascript">
	/* *
	 * ---------------------------------------- *
	 * åŸå¸‚é€‰æ‹©ç»„ä»¶ v1.0
	 * Author: VVG
	 * QQ: 83816819
	 * Mail: mysheller@163.com
	 * http://www.cnblogs.com/NNUF/
	 * ---------------------------------------- *
	 * Date: 2012-07-10
	 * ---------------------------------------- *
	 * */

	/* *
	 * å…¨å±€ç©ºé—´ Vcity
	 * */
	var Vcity = {};
	/* *
	 * é™æ€æ–¹æ³•é›†
	 * @name _m
	 * */
	Vcity._m = {
		/* é€‰æ‹©å…ƒç´  */
		$: function (arg, context) {
			var tagAll, n, eles = [], i, sub = arg.substring(1);
			context = context || document;
			if (typeof arg == 'string') {
				switch (arg.charAt(0)) {
					case '#':
						return document.getElementById(sub);
						break;
					case '.':
						if (context.getElementsByClassName) return context.getElementsByClassName(sub);
						tagAll = Vcity._m.$('*', context);
						n = tagAll.length;
						for (i = 0; i < n; i++) {
							if (tagAll[i].className.indexOf(sub) > -1) eles.push(tagAll[i]);
						}
						return eles;
						break;
					default:
						return context.getElementsByTagName(arg);
						break;
				}
			}
		},

		/* ç»‘å®šäº‹ä»¶ */
		on: function (node, type, handler) {
			node.addEventListener ? node.addEventListener(type, handler, false) : node.attachEvent('on' + type, handler);
		},

		/* è·å–äº‹ä»¶ */
		getEvent: function (event) {
			return event || window.event;
		},

		/* è·å–äº‹ä»¶ç›®æ ‡ */
		getTarget: function (event) {
			return event.target || event.srcElement;
		},

		/* è·å–å…ƒç´ ä½ç½® */
		getPos: function (node) {
			var scrollx = document.documentElement.scrollLeft || document.body.scrollLeft,
				scrollt = document.documentElement.scrollTop || document.body.scrollTop;
			var pos = node.getBoundingClientRect();
			return { top: pos.top + scrollt, right: pos.right + scrollx, bottom: pos.bottom + scrollt, left: pos.left + scrollx }
		},

		/* æ·»åŠ æ ·å¼å */
		addClass: function (c, node) {
			if (!node) return;
			node.className = Vcity._m.hasClass(c, node) ? node.className : node.className + ' ' + c;
		},

		/* ç§»é™¤æ ·å¼å */
		removeClass: function (c, node) {
			var reg = new RegExp("(^|\\s+)" + c + "(\\s+|$)", "g");
			if (!Vcity._m.hasClass(c, node)) return;
			node.className = reg.test(node.className) ? node.className.replace(reg, '') : node.className;
		},

		/* æ˜¯å¦å«æœ‰CLASS */
		hasClass: function (c, node) {
			if (!node || !node.className) return false;
			return node.className.indexOf(c) > -1;
		},

		/* é˜»æ­¢å†’æ³¡ */
		stopPropagation: function (event) {
			event = event || window.event;
			event.stopPropagation ? event.stopPropagation() : event.cancelBubble = true;
		},
		/* å»é™¤ä¸¤ç«¯ç©ºæ ¼ */
		trim: function (str) {
			return str.replace(/^\s+|\s+$/g, '');
		}
	};

	/* æ‰€æœ‰åŸå¸‚æ•°æ®,å¯ä»¥æŒ‰ç…§æ ¼å¼è‡ªè¡Œæ·»åŠ ï¼ˆåŒ—äº¬|beijing|bjï¼‰ï¼Œå‰16æ¡ä¸ºçƒ­é—¨åŸå¸‚ */

	Vcity.allCity = ['åŒ—äº¬|beijing|bj', 'ä¸Šæµ·|shanghai|sh', 'é‡åº†|chongqing|cq', 'æ·±åœ³|shenzhen|sz', 'å¹¿å·|guangzhou|gz', 'æ­å·|hangzhou|hz',
		'å—äº¬|nanjing|nj', 'è‹å·|shuzhou|sz', 'å¤©æ´¥|tianjin|tj', 'æˆéƒ½|chengdu|cd', 'å—æ˜Œ|nanchang|nc', 'ä¸‰äºš|sanya|sy', 'é’å²›|qingdao|qd',
		'å¦é—¨|xiamen|xm', 'è¥¿å®‰|xian|xa', 'é•¿æ²™|changsha|cs'];
	var city_str_nex = ""
	for (i in city_list) {
		city_str_nex = city_list[i].name + "|" + city_list[i].asciiName + "|" + city_list[i].asciiName.slice(0, 2);
		Vcity.allCity.push(city_str_nex);
	}

	/* æ­£åˆ™è¡¨è¾¾å¼ ç­›é€‰ä¸­æ–‡åŸå¸‚åã€æ‹¼éŸ³ã€é¦–å­—æ¯ */

	Vcity.regEx = /^([\u4E00-\u9FA5\uf900-\ufa2d]+)\|(\w+)\|(\w)\w*$/i;
	Vcity.regExChiese = /([\u4E00-\u9FA5\uf900-\ufa2d]+)/;

	/* *
	 * æ ¼å¼åŒ–åŸå¸‚æ•°ç»„ä¸ºå¯¹è±¡oCityï¼ŒæŒ‰ç…§a-h,i-p,q-z,hotçƒ­é—¨åŸå¸‚åˆ†ç»„ï¼š
	 * {HOT:{hot:[]},ABCDEFGH:{a:[1,2,3],b:[1,2,3]},IJKLMNOP:{i:[1.2.3],j:[1,2,3]},QRSTUVWXYZ:{}}
	 * */

	(function () {
		var citys = Vcity.allCity, match, letter,
			regEx = Vcity.regEx,
			reg2 = /^[a-h]$/i, reg3 = /^[i-p]$/i, reg4 = /^[q-z]$/i;
		if (!Vcity.oCity) {
			Vcity.oCity = { hot: {}, ABCDEFGH: {}, IJKLMNOP: {}, QRSTUVWXYZ: {} };
			//console.log(citys.length);
			for (var i = 0, n = citys.length; i < n; i++) {
				match = regEx.exec(citys[i]);
				letter = match[3].toUpperCase();
				if (reg2.test(letter)) {
					if (!Vcity.oCity.ABCDEFGH[letter]) Vcity.oCity.ABCDEFGH[letter] = [];
					Vcity.oCity.ABCDEFGH[letter].push(match[1]);
				} else if (reg3.test(letter)) {
					if (!Vcity.oCity.IJKLMNOP[letter]) Vcity.oCity.IJKLMNOP[letter] = [];
					Vcity.oCity.IJKLMNOP[letter].push(match[1]);
				} else if (reg4.test(letter)) {
					if (!Vcity.oCity.QRSTUVWXYZ[letter]) Vcity.oCity.QRSTUVWXYZ[letter] = [];
					Vcity.oCity.QRSTUVWXYZ[letter].push(match[1]);
				}
				/* çƒ­é—¨åŸå¸‚ å‰16æ¡ */
				if (i < 16) {
					if (!Vcity.oCity.hot['hot']) Vcity.oCity.hot['hot'] = [];
					Vcity.oCity.hot['hot'].push(match[1]);
				}
			}
		}
	})();
	/* åŸå¸‚HTMLæ¨¡æ¿ */
	Vcity._template = [
		'<p class="tip">çƒ­é—¨åŸå¸‚(æ”¯æŒæ±‰å­—/æ‹¼éŸ³)</p>',
		'<ul>',
		'<li class="on">çƒ­é—¨åŸå¸‚</li>',
		'<li>A~H</li>',
		'<li>I~P</li>',
		'<li>Q~Z</li>',
		'</ul>'
	];

	/* *
	 * åŸå¸‚æ§ä»¶æ„é€ å‡½æ•°
	 * @CitySelector
	 * */

	Vcity.CitySelector = function () {
		this.initialize.apply(this, arguments);
	};

	Vcity.CitySelector.prototype = {

		constructor: Vcity.CitySelector,

		/* åˆå§‹åŒ– */

		initialize: function (options) {
			var input = options.input;
			this.input = Vcity._m.$('#' + input);
			this.inputEvent();
		},

		/* *
		 * @createWarp
		 * åˆ›å»ºåŸå¸‚BOX HTML æ¡†æ¶
		 * */

		createWarp: function () {
			var inputPos = Vcity._m.getPos(this.input);
			var div = this.rootDiv = document.createElement('div');
			var that = this;

			// è®¾ç½®DIVé˜»æ­¢å†’æ³¡
			Vcity._m.on(this.rootDiv, 'click', function (event) {
				Vcity._m.stopPropagation(event);
			});

			// è®¾ç½®ç‚¹å‡»æ–‡æ¡£éšè—å¼¹å‡ºçš„åŸå¸‚é€‰æ‹©æ¡†
			Vcity._m.on(document, 'click', function (event) {
				event = Vcity._m.getEvent(event);
				var target = Vcity._m.getTarget(event);
				if (target == that.input) return false;
				//console.log(target.className);
				if (that.cityBox) Vcity._m.addClass('hide', that.cityBox);
				if (that.ul) Vcity._m.addClass('hide', that.ul);
				if (that.myIframe) Vcity._m.addClass('hide', that.myIframe);
			});
			div.className = 'citySelector';
			div.style.position = 'absolute';
			div.style.left = inputPos.left + 'px';
			div.style.top = inputPos.bottom + 'px';
			div.style.zIndex = 999999;

			// åˆ¤æ–­æ˜¯å¦IE6ï¼Œå¦‚æœæ˜¯IE6éœ€è¦æ·»åŠ iframeæ‰èƒ½é®ä½SELECTæ¡†
			var isIe = (document.all) ? true : false;
			var isIE6 = this.isIE6 = isIe && !window.XMLHttpRequest;
			if (isIE6) {
				var myIframe = this.myIframe = document.createElement('iframe');
				myIframe.frameborder = '0';
				myIframe.src = 'about:blank';
				myIframe.style.position = 'absolute';
				myIframe.style.zIndex = '-1';
				this.rootDiv.appendChild(this.myIframe);
			}

			var childdiv = this.cityBox = document.createElement('div');
			childdiv.className = 'cityBox';
			childdiv.id = 'cityBox';
			childdiv.innerHTML = Vcity._template.join('');
			var hotCity = this.hotCity = document.createElement('div');
			hotCity.className = 'hotCity';
			childdiv.appendChild(hotCity);
			div.appendChild(childdiv);
			this.createHotCity();
		},

		/* *
		 * @createHotCity
		 * TABä¸‹é¢DIVï¼šhot,a-h,i-p,q-z åˆ†ç±»HTMLç”Ÿæˆï¼ŒDOMæ“ä½œ
		 * {HOT:{hot:[]},ABCDEFGH:{a:[1,2,3],b:[1,2,3]},IJKLMNOP:{},QRSTUVWXYZ:{}}
		 **/

		createHotCity: function () {
			var odiv, odl, odt, odd, odda = [], str, key, ckey, sortKey, regEx = Vcity.regEx,
				oCity = Vcity.oCity;
			for (key in oCity) {
				odiv = this[key] = document.createElement('div');
				// å…ˆè®¾ç½®å…¨éƒ¨éšè—hide
				odiv.className = key + ' ' + 'cityTab hide';
				sortKey = [];
				for (ckey in oCity[key]) {
					sortKey.push(ckey);
					// ckeyæŒ‰ç…§ABCDEDGé¡ºåºæ’åº
					sortKey.sort();
				}
				for (var j = 0, k = sortKey.length; j < k; j++) {
					odl = document.createElement('dl');
					odt = document.createElement('dt');
					odd = document.createElement('dd');
					odt.innerHTML = sortKey[j] == 'hot' ? '&nbsp;' : sortKey[j];
					odda = [];
					for (var i = 0, n = oCity[key][sortKey[j]].length; i < n; i++) {
						str = '<a href="#">' + oCity[key][sortKey[j]][i] + '</a>';
						odda.push(str);
					}
					odd.innerHTML = odda.join('');
					odl.appendChild(odt);
					odl.appendChild(odd);
					odiv.appendChild(odl);
				}

				// ç§»é™¤çƒ­é—¨åŸå¸‚çš„éšè—CSS
				Vcity._m.removeClass('hide', this.hot);
				this.hotCity.appendChild(odiv);
			}
			document.body.appendChild(this.rootDiv);
			/* IE6 */
			this.changeIframe();

			this.tabChange();
			this.linkEvent();
		},

		/* *
		 *  tabæŒ‰å­—æ¯é¡ºåºåˆ‡æ¢
		 *  @ tabChange
		 * */

		tabChange: function () {
			var lis = Vcity._m.$('li', this.cityBox);
			var divs = Vcity._m.$('div', this.hotCity);
			var that = this;
			for (var i = 0, n = lis.length; i < n; i++) {
				lis[i].index = i;
				lis[i].onclick = function () {
					for (var j = 0; j < n; j++) {
						Vcity._m.removeClass('on', lis[j]);
						Vcity._m.addClass('hide', divs[j]);
					}
					Vcity._m.addClass('on', this);
					Vcity._m.removeClass('hide', divs[this.index]);
					/* IE6 æ”¹å˜TABçš„æ—¶å€™ æ”¹å˜Iframe å¤§å°*/
					that.changeIframe();
				};
			}
		},

		/* *
		 * åŸå¸‚LINKäº‹ä»¶
		 *  @linkEvent
		 * */

		linkEvent: function () {
			var links = Vcity._m.$('a', this.hotCity);
			var that = this;
			for (var i = 0, n = links.length; i < n; i++) {
				links[i].onclick = function () {
					that.input.value = this.innerHTML;
					Vcity._m.addClass('hide', that.cityBox);
					/* ç‚¹å‡»åŸå¸‚åçš„æ—¶å€™éšè—myIframe */
					Vcity._m.addClass('hide', that.myIframe);
				}
			}
		},

		/* *
		 * INPUTåŸå¸‚è¾“å…¥æ¡†äº‹ä»¶
		 * @inputEvent
		 * */

		inputEvent: function () {
			var that = this;
			Vcity._m.on(this.input, 'click', function (event) {
				event = event || window.event;
				if (!that.cityBox) {
					that.createWarp();
				} else if (!!that.cityBox && Vcity._m.hasClass('hide', that.cityBox)) {
					// slideul ä¸å­˜åœ¨æˆ–è€… slideulå­˜åœ¨ä½†æ˜¯æ˜¯éšè—çš„æ—¶å€™ ä¸¤è€…ä¸èƒ½å…±å­˜
					if (!that.ul || (that.ul && Vcity._m.hasClass('hide', that.ul))) {
						Vcity._m.removeClass('hide', that.cityBox);

						/* IE6 ç§»é™¤iframe çš„hide æ ·å¼ */
						//alert('click');
						Vcity._m.removeClass('hide', that.myIframe);
						that.changeIframe();
					}
				}
			});
			Vcity._m.on(this.input, 'focus', function () {
				that.input.select();
				if (that.input.value == localString[g_language].city_name) that.input.value = '';
			});
			Vcity._m.on(this.input, 'blur', function () {
				if (that.input.value == '') that.input.value = localString[g_language].city_name;
			});
			Vcity._m.on(this.input, 'keyup', function (event) {
				event = event || window.event;
				var keycode = event.keyCode;
				Vcity._m.addClass('hide', that.cityBox);
				that.createUl();

				/* ç§»é™¤iframe çš„hide æ ·å¼ */
				Vcity._m.removeClass('hide', that.myIframe);

				// ä¸‹æ‹‰èœå•æ˜¾ç¤ºçš„æ—¶å€™æ•æ‰æŒ‰é”®äº‹ä»¶
				if (that.ul && !Vcity._m.hasClass('hide', that.ul) && !that.isEmpty) {
					that.KeyboardEvent(event, keycode);
				}
			});
		},

		/* *
		 * ç”Ÿæˆä¸‹æ‹‰é€‰æ‹©åˆ—è¡¨
		 * @ createUl
		 * */

		createUl: function () {
			//console.log('createUL');
			var str;
			var value = Vcity._m.trim(this.input.value);
			// å½“valueä¸ç­‰äºç©ºçš„æ—¶å€™æ‰§è¡Œ
			if (value !== '') {
				var reg = new RegExp("^" + value + "|\\|" + value, 'gi');
				// æ­¤å¤„éœ€è®¾ç½®ä¸­æ–‡è¾“å…¥æ³•ä¹Ÿå¯ç”¨onpropertychange
				var searchResult = [];
				for (var i = 0, n = Vcity.allCity.length; i < n; i++) {
					if (reg.test(Vcity.allCity[i])) {
						var match = Vcity.regEx.exec(Vcity.allCity[i]);
						if (searchResult.length !== 0) {
							str = '<li><b class="cityname">' + match[1] + '</b><b class="cityspell">' + match[2] + '</b></li>';
						} else {
							str = '<li class="on"><b class="cityname">' + match[1] + '</b><b class="cityspell">' + match[2] + '</b></li>';
						}
						searchResult.push(str);
					}
				}
				this.isEmpty = false;
				// å¦‚æœæœç´¢æ•°æ®ä¸ºç©º
				if (searchResult.length == 0) {
					this.isEmpty = true;
					str = '<li class="empty">å¯¹ä¸èµ·ï¼Œæ²¡æœ‰æ‰¾åˆ°æ•°æ® "<em>' + value + '</em>"</li>';
					searchResult.push(str);
				}
				// å¦‚æœslideulä¸å­˜åœ¨åˆ™æ·»åŠ ul
				if (!this.ul) {
					var ul = this.ul = document.createElement('ul');
					ul.className = 'cityslide';
					this.rootDiv && this.rootDiv.appendChild(ul);
					// è®°å½•æŒ‰é”®æ¬¡æ•°ï¼Œæ–¹å‘é”®
					this.count = 0;
				} else if (this.ul && Vcity._m.hasClass('hide', this.ul)) {
					this.count = 0;
					Vcity._m.removeClass('hide', this.ul);
				}
				this.ul.innerHTML = searchResult.join('');

				/* IE6 */
				this.changeIframe();

				// ç»‘å®šLiäº‹ä»¶
				this.liEvent();
			} else {
				Vcity._m.addClass('hide', this.ul);
				Vcity._m.removeClass('hide', this.cityBox);

				Vcity._m.removeClass('hide', this.myIframe);

				this.changeIframe();
			}
		},

		/* IE6çš„æ”¹å˜é®ç½©SELECT çš„ IFRAMEå°ºå¯¸å¤§å° */
		changeIframe: function () {
			if (!this.isIE6) return;
			this.myIframe.style.width = this.rootDiv.offsetWidth + 'px';
			this.myIframe.style.height = this.rootDiv.offsetHeight + 'px';
		},

		/* *
		 * ç‰¹å®šé”®ç›˜äº‹ä»¶ï¼Œä¸Šã€ä¸‹ã€Enteré”®
		 * @ KeyboardEvent
		 * */

		KeyboardEvent: function (event, keycode) {
			var lis = Vcity._m.$('li', this.ul);
			var len = lis.length;
			switch (keycode) {
				case 40: //å‘ä¸‹ç®­å¤´â†“
					this.count++;
					if (this.count > len - 1) this.count = 0;
					for (var i = 0; i < len; i++) {
						Vcity._m.removeClass('on', lis[i]);
					}
					Vcity._m.addClass('on', lis[this.count]);
					break;
				case 38: //å‘ä¸Šç®­å¤´â†‘
					this.count--;
					if (this.count < 0) this.count = len - 1;
					for (i = 0; i < len; i++) {
						Vcity._m.removeClass('on', lis[i]);
					}
					Vcity._m.addClass('on', lis[this.count]);
					break;
				case 13: // enteré”®
					this.input.value = Vcity.regExChiese.exec(lis[this.count].innerHTML)[0];
					Vcity._m.addClass('hide', this.ul);
					Vcity._m.addClass('hide', this.ul);
					/* IE6 */
					Vcity._m.addClass('hide', this.myIframe);
					break;
				default:
					break;
			}
		},

		/* *
		 * ä¸‹æ‹‰åˆ—è¡¨çš„liäº‹ä»¶
		 * @ liEvent
		 * */

		liEvent: function () {
			var that = this;
			var lis = Vcity._m.$('li', this.ul);
			for (var i = 0, n = lis.length; i < n; i++) {
				Vcity._m.on(lis[i], 'click', function (event) {
					event = Vcity._m.getEvent(event);
					var target = Vcity._m.getTarget(event);
					that.input.value = Vcity.regExChiese.exec(target.innerHTML)[0];
					Vcity._m.addClass('hide', that.ul);
					/* IE6 ä¸‹æ‹‰èœå•ç‚¹å‡»äº‹ä»¶ */
					Vcity._m.addClass('hide', that.myIframe);
				});
				Vcity._m.on(lis[i], 'mouseover', function (event) {
					event = Vcity._m.getEvent(event);
					var target = Vcity._m.getTarget(event);
					Vcity._m.addClass('on', target);
				});
				Vcity._m.on(lis[i], 'mouseout', function (event) {
					event = Vcity._m.getEvent(event);
					var target = Vcity._m.getTarget(event);
					Vcity._m.removeClass('on', target);
				})
			}
		}
	};
	var test = new Vcity.CitySelector({ input: 'citySelect' });
	var test2 = new Vcity.CitySelector({ input: 'citySelect1' });
</script>

</body>

</html>