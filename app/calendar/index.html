<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<link href="../lib/main.css" rel="stylesheet" />
		<script src="../public/js/jquery.js"></script>
		<script src="../public/js/comm.js"></script>
		<script src="jquery-3.3.1.min.js"></script>
		<script src="julian.js"></script>
		<script src="lune.js"></script>
		<script src="suncalc.js"></script>
		<script src="./planet_position/js/planet-positions.js"></script>

		<script src="../studio/js/fixedsticky.js"></script>
		<script src="../guide/guide.js"></script>
		<link type="text/css" rel="stylesheet" href="../guide/guide.css" />

		<script src="../public/js/marked.js"></script>
		<!--è·å–è¯­è¨€-->

		<script>
			var g_language = "en";
			var g_currLink = "";
			function lang_init(strPage) {
				g_currLink = strPage;
			}
			function setLang(strLang) {
				g_language = strLang;
				setCookie("language", g_language, 365);
				window.location.assign(location.pathname + "?language=" + g_language);
			}
		</script>
		<script>
			var localString = new Array();
			localString["zh-cn"] = {
				and_another: "åˆ ",
				atitude: "çº¬åº¦",
				BE: "ä½›å†",
				bhumma: "å‘¨äºŒ",
				budha: "å‘¨ä¸‰",
				canda: "å‘¨ä¸€",
				confirm: "ç¡®è®¤",
				date: "æ—¥æœŸ",
				day: "æ—¥",
				days: "å¤© ",
				departure_in_detail: "èµ·é£è¯¦æƒ…",
				dhamma_time: "ä¼šå»¶ç»­äº”åƒå¹´çš„æ•™æ³• ",
				eat: "è¿›é¤",
				gama_entry: "å…¥æ‘",
				guru: "å‘¨å››",
				hori_ref_time: "è’™æ°”å·®ä¿®æ­£ ",
				kala: "é€‚å½“çš„æ—¶é—´",
				language_select: "é€‰æ‹©è¯­è¨€",
				left: "è¿˜å‰©ä¸‹",
				loading: "è½½å…¥ä¸­â€¦â€¦",
				longitude: "ç»åº¦",
				mÄsa: "æœˆ",
				mins: "åˆ†é’Ÿ",
				month: "æœˆ ",
				month_1: "æœˆ ",
				months: "ä¸ªæœˆ ",
				my_loc: "æˆ‘çš„ä½ç½®",
				need_inform: "æœªå‘ŠçŸ¥å…¶ä»–æ¯”åº“",
				no_string: "ä¸èƒ½",
				noon_time: "æ­£åˆ",
				noon_time: "æ­£åˆ",
				note: "æ³¨é‡Š",
				now_time: "ç°åœ¨",
				pacchÄ_mÄsa: "ä¸‹ä¸ªæœˆ",
				pakkha: "æœˆç›¸å˜åŒ– ",
				past: "å·²è¿‡å»",
				pubba_mÄsa: "ä¸Šä¸ªæœˆ",
				ravi: "å‘¨æ—¥",
				saá¹ƒvacchara: "å¹´",
				season: "å­£èŠ‚ ",
				sec: "ç§’",
				sora: "å‘¨å…­",
				sukka: "å‘¨äº”",
				sun_height_degree: "æ­£åˆå¤ªé˜³é«˜åº¦ ",
				time: "æ—¶é—´",
				twilight_time: "æ›™å…‰",
				twilight_time: "æ›™å…‰",
				vikala: "ä¸é€‚å½“çš„æ—¶é—´",
				week_day: "æ˜ŸæœŸ",
				year_0: "å¹´",
				year_1: "å¹´ ",
				years: "å¹´ ",
				yes_string: "å¯ä»¥",
				timezone: "æ—¶åŒº",
				local: "æœ¬åœ°",
				loading: "è½½å…¥ä¸­",
			};
			localString["zh-tw"] = {
				and_another: "åˆ ",
				atitude: "ç·¯åº¦",
				BE: "ä½›æ›†",
				bhumma: "é€±äºŒ",
				budha: "é€±ä¸‰",
				canda: "é€±ä¸€",
				confirm: "ç¢ºèª",
				date: "æ—¥æœŸ",
				day: "æ—¥",
				days: "å¤© ",
				departure_in_detail: "èµ·é£›è©³æƒ…",
				dhamma_time: "æœƒå»¶çºŒäº”åƒå¹´çš„æ•™æ³• ",
				eat: "é€²é¤",
				gama_entry: "å…¥æ‘",
				guru: "é€±å››",
				hori_ref_time: "è’™æ°£å·®ä¿®æ­£ ",
				kala: "é©ç•¶çš„æ™‚é–“",
				language_select: "é¸æ“‡èªè¨€",
				left: "é‚„å‰©ä¸‹",
				loading: "è¼‰å…¥ä¸­â€¦â€¦",
				longitude: "ç¶“åº¦",
				mÄsa: "æœˆ",
				mins: "åˆ†é˜",
				month: "æœˆ ",
				month_1: "æœˆ ",
				months: "å€‹æœˆ ",
				my_loc: "æˆ‘çš„ä½ç½®",
				need_inform: "æœªå‘ŠçŸ¥å…¶ä»–æ¯”åº«",
				no_string: "ä¸èƒ½",
				noon_time: "æ­£åˆ",
				noon_time: "æ­£åˆ",
				note: "è¨»é‡‹",
				now_time: "ç¾åœ¨",
				pacchÄ_mÄsa: "ä¸‹å€‹æœˆ",
				pakkha: "æœˆç›¸è®ŠåŒ– ",
				past: "å·²éå»",
				pubba_mÄsa: "ä¸Šå€‹æœˆ",
				ravi: "é€±æ—¥",
				saá¹ƒvacchara: "å¹´",
				season: "å­£ç¯€ ",
				sec: "ç§’",
				sora: "é€±å…­",
				sukka: "é€±äº”",
				sun_height_degree: "æ­£åˆå¤ªé™½é«˜åº¦ ",
				time: "æ™‚é–“",
				twilight_time: "æ›™å…‰",
				twilight_time: "æ›™å…‰",
				vikala: "ä¸é©ç•¶çš„æ™‚é–“",
				week_day: "æ˜ŸæœŸ",
				year_0: "å¹´",
				year_1: "å¹´ ",
				years: "å¹´ ",
				yes_string: "å¯ä»¥",
				timezone: "æ™‚å€",
				local: "æœ¬åœ°",
				loading: "è¼‰å…¥ä¸­",
			};
			localString["default"] = {
				and_another: " and ",
				atitude: "Atitude",
				BE: "Buddhist Era ",
				bhumma: "Bhumma",
				budha: "Budha",
				canda: "Canda",
				confirm: "Confirm",
				date: "Date ",
				day: " day(s) ",
				days: " day(s) ",
				departure_in_detail: "departure in detail",
				dhamma_time: "5000 Years of the Buddhaâ€™s Dispensation ",
				eat: "eat",
				gama_entry: "entry the village",
				guru: "Guru",
				hori_ref_time: "horizontal refraction correct ",
				kala: "suitable time",
				language_select: "bhÄsÄ",
				left: "Remains ",
				loading: "loadingâ€¦",
				longitude: "Longitude",
				mÄsa: "mÄsa",
				mins: "(min)",
				month: "Month ",
				month_1: "- ",
				months: " month(s) ",
				my_loc: "attasmiá¹ƒ",
				need_inform: "without informing other Bhikkhu ",
				no_string: "cannot ",
				noon_time: "NOON",
				noon_time: "NOON",
				note: "Note",
				now_time: "NOW",
				pacchÄ_mÄsa: "pacchÄ-mÄsa",
				pakkha: "Lunar Phases ",
				past: "Passed ",
				pubba_mÄsa: "pubba-mÄsa",
				ravi: "Ravi",
				saá¹ƒvacchara: "saá¹ƒvacchara",
				season: "Season ",
				sec: "sec ",
				sora: "Sora",
				sukka: "Sukka",
				sun_height_degree: "Max solar altitude ",
				time: "Time",
				twilight_time: "dawn",
				twilight_time: "dawn",
				vikala: "unsuitable time",
				week_day: "Day",
				year_0: "saá¹ƒvacchara",
				year_1: "- ",
				years: " year(s) ",
				yes_string: "can ",
				timezone: "Timezone",
				local: "local",
				loading: "loading",
			};
			localString["en"] = {
				and_another: " and ",
				atitude: "Atitude",
				BE: "Buddhist Era ",
				bhumma: "Bhumma",
				budha: "Budha",
				canda: "Canda",
				confirm: "Confirm",
				date: "Date",
				day: " day(s) ",
				days: " day(s) ",
				departure_in_detail: "departure in detail",
				dhamma_time: "5000 Years of the Buddhaâ€™s Dispensation ",
				eat: "eat",
				gama_entry: "entry the village",
				guru: "Guru",
				hori_ref_time: "horizontal refraction correct ",
				kala: "suitable time",
				language_select: "Language",
				left: "Remains ",
				loading: "loadingâ€¦",
				longitude: "Longitude",
				mÄsa: "mÄsa",
				mins: "(min)",
				month: "Month ",
				month_1: "- ",
				months: " month(s) ",
				my_loc: "my location",
				need_inform: "without informing other Bhikkhu ",
				no_string: "cannot ",
				noon_time: "NOON",
				noon_time: "NOON",
				note: "Note",
				now_time: "NOW",
				pacchÄ_mÄsa: "pacchÄ-mÄsa",
				pakkha: "Lunar Phases ",
				past: "Passed ",
				pubba_mÄsa: "pubba-mÄsa",
				ravi: "Ravi",
				saá¹ƒvacchara: "saá¹ƒvacchara",
				season: "Season ",
				sec: "sec",
				sora: "Sora",
				sukka: "Sukka",
				sun_height_degree: "Max solar altitude ",
				time: "time",
				twilight_time: "dawn",
				twilight_time: "dawn",
				vikala: "unsuitable time",
				week_day: "Day",
				year_0: "year",
				year_1: "- ",
				years: " year(s) ",
				yes_string: "can ",
				timezone: "Timezone",
				local: "local",
				loading: "loading",
			};
			localString["my"] = {
				and_another: " and ",
				atitude: "Atitude",
				BE: "Buddhist Era ",
				bhumma: "á€˜á€¯á€™á€¹á€™",
				budha: "á€—á€¯á€“",
				canda: "á€…á€”á€¹á€’",
				confirm: "Confirm",
				date: "Date ",
				day: " day(s) ",
				days: " day(s) ",
				departure_in_detail: "departure in detail",
				dhamma_time: "5000 Years of the Buddhaâ€™s Dispensation ",
				eat: "eat",
				gama_entry: "entry the village",
				guru: "á€‚á€¯á€›á€¯",
				hori_ref_time: "horizontal refraction correct ",
				kala: "á€€á€¬á€œ",
				language_select: "á€˜á€¬á€á€¬",
				left: "Remains ",
				loading: "loadingâ€¦",
				longitude: "Longitude",
				mÄsa: "á€™á€¬á€",
				mins: "(min)",
				month: "Month ",
				month_1: "- ",
				months: " month(s) ",
				my_loc: "á€¡á€á€¹á€á€á€¹á€™á€­á€¶",
				need_inform: "without informing other Bhikkhu ",
				no_string: "cannot ",
				noon_time: "á€™á€‡á€¹á€ˆá€”á€¹á€Ÿá€­á€€",
				noon_time: "á€™á€‡á€¹á€ˆá€”á€¹á€Ÿá€­á€€",
				note: "Note",
				now_time: "á€•á€…á€¹á€…á€¯á€•á€¹á€•á€”á€¹á€”",
				pacchÄ_mÄsa: "á€•á€…á€¹á€†á€¬-á€™á€¬á€",
				pakkha: "Lunar Phases ",
				past: "Passed ",
				pubba_mÄsa: "á€•á€¯á€—á€¹á€—-á€™á€¬á€",
				ravi: "á€›á€á€­",
				saá¹ƒvacchara: "á€á€¶á€á€…á€¹á€†á€›",
				season: "Season ",
				sec: "sec ",
				sora: "á€á€±á€¬á€›",
				sukka: "á€á€¯á€€á€¹á€€",
				sun_height_degree: "Max solar altitude ",
				time: "Time",
				twilight_time: "á€¡á€›á€¯á€á€¯á€‚á€¹á€‚á€™á€”",
				twilight_time: "á€¡á€›á€¯á€á€¯á€‚á€¹á€‚á€™á€”",
				vikala: "á€á€­á€€á€¬á€œ",
				week_day: "Day",
				year_0: "year",
				year_1: "- ",
				years: " year(s) ",
				yes_string: "can ",
				timezone: "Timezone",
				local: "local",
				loading: "loading",
			};
			localString["si"] = {
				and_another: " à¶  ",
				atitude: "Atitude",
				BE: "à¶¶à·”à¶¯à·Šà¶° à·€à¶»à·Šà·‚à¶º ",
				bhumma: "à¶·à·”à¶¸à·Šà¶¸",
				budha: "à¶¶à·”à¶°",
				canda: "à¶ à¶±à·Šà¶¯",
				confirm: "Confirm",
				date: "à¶¯à·’à·€à·ƒ ",
				day: " à¶¯à·’à·€à·ƒà·(à¶±à·’) ",
				days: " à¶¯à·’à·€à·ƒà·(à¶±à·’) ",
				departure_in_detail: "departure in detail",
				dhamma_time: "à·ƒà¶¸à·Šà¶¸à· à·ƒà¶¸à·Šà¶¶à·”à¶¯à·Šà¶°à·ƒà·Šà·ƒ à·ƒà·à·ƒà¶±à¶‚ à¶´à¶§à·Šà¶ -à·€à·ƒà·Šà·ƒ-à·ƒà·„à·ƒà·Šà·ƒà·à¶±à·’ à¶´à·€à¶­à·Šà¶­à·’à·ƒà·Šà·ƒà¶­à·’ ",
				eat: "eat",
				gama_entry: "entry the village",
				guru: "à¶œà·”â€à¶»à·”",
				hori_ref_time: "horizontal refraction correct ",
				kala: "à¶šà·à¶½",
				language_select: "à¶·à·à·‚à·à·€",
				left: "à¶…à·€à·ƒà·’à¶§à·Šà¶¨ ",
				loading: "à¶´à·Šâ€à¶»à·€à·šà·à¶±à¶º à·€à·™à¶±à·€à· ",
				longitude: "Longitude",
				mÄsa: "à¶¸à·à·ƒ",
				mins: "(min)",
				month: "à¶¸à·à·ƒ ",
				month_1: "- ",
				months: " à¶¸à·à·ƒà·(à¶±à·’) ",
				my_loc: "à¶…à¶­â€à·Šà¶­à·ƒâ€à·Šà¶¸à·’à¶‚",
				need_inform: "without informing other Bhikkhu ",
				no_string: "cannot ",
				noon_time: "à¶¸à¶¢à·Šà¶£à¶±à·Šà·„à·’à¶š",
				noon_time: "à¶¸à¶¢à·Šà¶£à¶±à·Šà·„à·’à¶š",
				note: "à¶±à·à¶§à·Šà¶§à·”à·€ ",
				now_time: "à¶´à¶ à·Šà¶ à·”à¶´à·Šà¶´à¶±à·Šà¶±",
				pacchÄ_mÄsa: "à¶´à¶ à·Šà¶¡à·-à¶¸à·à·ƒ",
				pakkha: "à¶´à¶šà·Šà¶› ",
				past: "à¶…à¶­à·’à¶šà·Šà¶šà¶±à·Šà¶­ ",
				pubba_mÄsa: "à¶´à·”à¶¶à·Šà¶¶-à¶¸à·à·ƒ",
				ravi: "à¶»à·€à·’",
				saá¹ƒvacchara: "à·ƒà¶‚à·€à¶ à·Šà¶¡â€à¶»",
				season: "à¶‹à¶­à·” ",
				sec: "sec",
				sora: "à·ƒà·œâ€à¶»",
				sukka: "à·ƒà·”à¶šà·Šà¶š",
				sun_height_degree: "Max solar altitude ",
				time: "time",
				twilight_time: "à¶…â€à¶»à·”à¶«à·”à¶œà·Šà¶œà¶¸à¶±",
				twilight_time: "à¶…â€à¶»à·”à¶«à·”à¶œà·Šà¶œà¶¸à¶±",
				vikala: "à·€à·’à¶šà·à¶½",
				week_day: "à·€à·â€à¶» ",
				year_0: "à·ƒà¶‚à·€à¶ à·Šà¶¡â€à¶»",
				year_1: "- ",
				years: " à·ƒà¶‚à·€à¶ à·Šà¶¡â€à¶»à·(à¶±à·’) ",
				yes_string: "can ",
				timezone: "Timezone",
				local: "local",
				loading: "loading",
			};
			var pali_month_name = [
				{ id: "1", value: "jeá¹­á¹­ha", season: "gimhÄna", season_icon: "â˜€" }, //5.X-å››-åäº”-å¿ƒ
				{ id: "2", value: "asÄá¸·ha", season: "gimhÄna", season_icon: "â˜€" }, //6.X-äº”-åäº”ã€åå…­-ç®•ã€æ–—
				{ id: "3", value: "sÄvana", season: "vassÄna", season_icon: "â˜”" }, //7.X-å…­-åäº”-å¥³
				{ id: "4", value: "poá¹­á¹­hapÄda", season: "vassÄna", season_icon: "â˜”" }, //8.x-ä¸ƒ-åäº”ã€åå…­-å®¤ã€å£
				{ id: "5", value: "assajuja", season: "vassÄna", season_icon: "â˜”" }, //9.X-å…«-åäº”-æ¨“
				{ id: "6", value: "kattika", season: "vassÄna", season_icon: "â˜”" }, //10.X-ä¹-åäº”-æ˜‚
				{ id: "7", value: "mÄgasira", season: "hemanta", season_icon: "â„" }, //11.X-å-åäº”-è§œ
				{ id: "8", value: "phussa", season: "hemanta", season_icon: "â„" }, //12.X-åä¸€-åäº”-é¬¼
				{ id: "9", value: "mÄgha", season: "hemanta", season_icon: "â„" }, //1.X-åäºŒ-åäº”-æ˜Ÿ
				{ id: "10", value: "phagguna", season: "hemanta", season_icon: "â„" }, //2.X-æ­£æœˆ-åå››ã€åäº”-å¼µã€ç•°
				{ id: "11", value: "citta", season: "gimhÄna", season_icon: "â˜€" }, //3.X-äºŒæœˆ-åäº”-è§’
				{ id: "12", value: "vesÄkha", season: "gimhÄna", season_icon: "â˜€" }, //4.X-ä¸‰æœˆ-åäº”-æ°
			];
			var pali_nakkhatta_name = [
				{ id: "0", value: "assayuja", name_zh: "å¨„å®¿" },
				{ id: "1", value: "bharaá¹‡Ä«", name_zh: "èƒƒå®¿" },
				{ id: "2", value: "KattikÄ", name_zh: "æ˜‚å®¿" },
				{ id: "3", value: "rohiá¹‡Ä«", name_zh: "æ¯•å®¿" },
				{ id: "4", value: "magasira", name_zh: "è§œå®¿" },
				{ id: "5", value: "AddÄ", name_zh: "å‚å®¿" },
				{ id: "6", value: "punabbasu", name_zh: "äº•å®¿" },
				{ id: "7", value: "phussa", name_zh: "é¬¼å®¿" },
				{ id: "8", value: "AsilesÄ", name_zh: "æŸ³å®¿" },
				{ id: "9", value: "maghÄ", name_zh: "æ˜Ÿå®¿" },
				{ id: "10", value: "pubbaphagguá¹‡Ä«", name_zh: "å¼ å®¿" },
				{ id: "11", value: "uttaraphagguá¹‡Ä«", name_zh: "ç¿¼å®¿" },
				{ id: "12", value: "hattha", name_zh: "è½¸å®¿" },
				{ id: "13", value: "cittÄ", name_zh: "è§’å®¿" },
				{ id: "14", value: "sÄti", name_zh: "äº¢å®¿" },
				{ id: "15", value: "visÄkhÄ", name_zh: "æ°å®¿" },
				{ id: "16", value: "anurÄdhÄ", name_zh: "æˆ¿å®¿" },
				{ id: "17", value: "jeá¹­á¹­ha", name_zh: "å¿ƒå®¿" },
				{ id: "18", value: "mÅ«lÄ", name_zh: "å°¾å®¿" },
				{ id: "19", value: "pubbÄsÄá¸·ha", name_zh: "ç®•å®¿" },
				{ id: "20", value: "uttarÄsÄá¸·ha", name_zh: "æ–—å®¿" },
				{ id: "21", value: "savaá¹‡a", name_zh: "å¥³å®¿" },
				{ id: "22", value: "dhaniá¹­á¹­hÄ", name_zh: "è™šå®¿" },
				{ id: "23", value: "satabhisaja", name_zh: "å±å®¿" },
				{ id: "24", value: "pubbabhaddapadÄ", name_zh: "å®¤å®¿" },
				{ id: "25", value: "uttarabhaddapadÄ", name_zh: "å£å®¿" },
				{ id: "26", value: "revatÄ«", name_zh: "å¥å®¿" },
			];
			var horoscope_name = [
				{ id: "0", value: "Aries", name_zh: "ç™½ç¾Š", icon: "â™ˆ" },
				{ id: "1", value: "Taurus", name_zh: "é‡‘ç‰›", icon: "â™‰" },
				{ id: "2", value: "Gemini", name_zh: "åŒå­", icon: "â™Š" },
				{ id: "3", value: "Cancer", name_zh: "å·¨èŸ¹", icon: "â™‹" },
				{ id: "4", value: "Leo", name_zh: "ç‹®å­", icon: "â™Œ" },
				{ id: "5", value: "Virgo", name_zh: "å¤„å¥³", icon: "â™" },
				{ id: "6", value: "Libra", name_zh: "å¤©ç§¤", icon: "â™" },
				{ id: "7", value: "Scorpio", name_zh: "å¤©è", icon: "â™" },
				{ id: "8", value: "Sagittarius", name_zh: "å°„æ‰‹", icon: "â™" },
				{ id: "9", value: "Capricornus", name_zh: "æ‘©ç¾¯", icon: "â™‘" },
				{ id: "10", value: "Aquarius", name_zh: "æ°´ç“¶", icon: "â™’" },
				{ id: "11", value: "Pisces", name_zh: "åŒé±¼", icon: "â™“" },
			];
		</script>
		<script>
			var current_phase = phase();
			console.log(current_phase); //è¾“å‡ºåˆ°æ§åˆ¶å°

			//$("#title_text").html(localString[g_language].BE);
			var new_list = new Array(); //æ–°æœˆåˆ—è¡¨
			var first_list = new Array(); //ä¸Šå¼¦æœˆåˆ—è¡¨
			var full_list = new Array(); //æ»¡æœˆåˆ—è¡¨
			var last_list = new Array(); //ä¸‹å¼¦æœˆåˆ—è¡¨
			var planets = new Array(); //
			var lunar_position = new Object();

			var g_coordinate_this = new Object();
			var g_now_date = new Date();
			var today = new Date();
			var start_day = new Date();
			var next_year = new Date();
			var sun_times = new Object();

			var curr_position = localStorage.getItem("local_position");
			if (curr_position) {
				g_coordinate_this.AT = curr_position.split("#")[0];
				g_coordinate_this.LT = curr_position.split("#")[1];
				g_coordinate_this.height = curr_position.split("#")[2];
				if (g_coordinate_this.AT >= 0) {
					var AT_string = angle_trans(g_coordinate_this.AT) + "N";
				} else {
					var AT_string = angle_trans(g_coordinate_this.AT) + "S";
				}
				if (g_coordinate_this.LT >= 0) {
					var LT_string = angle_trans(g_coordinate_this.LT) + "E";
				} else {
					var LT_string = angle_trans(g_coordinate_this.LT) + "W";
				}
				let height_string = g_coordinate_this.height + "M";
				$("#selected_position_string").html(AT_string + " " + LT_string + " " + height_string);
			} else {
				getLocation();
			}
			function show_time() {
				if ($("#input_time").val()) {
					today = new Date($("#input_time").val());
				} else {
					today = g_now_date;
				}
				lunar_phase_list_refresh();
				get_position(today);

				let d_earth_to_moon =
					lunar_position.position.x ^
					(2 + lunar_position.position.y) ^
					(2 + lunar_position.position.z) ^
					2 ^
					0.5;
				let d_earth_to_moon_0 = phase(today).distance;

				sun_times = SunCalc.getTimes(
					today,
					g_coordinate_this.AT,
					g_coordinate_this.LT,
					g_coordinate_this.height / 1000
				);
				sun_position = SunCalc.getPosition(today, g_coordinate_this.AT, g_coordinate_this.LT);
				moon_position = SunCalc.getMoonPosition(today, g_coordinate_this.AT, g_coordinate_this.LT);
				moon_Illumination = SunCalc.getMoonIllumination(today);
				$("#today_dawn").html(sun_times.dawn.toLocaleTimeString()); //ç ´æ™“
				$("#today_solarNoon").html(sun_times.solarNoon.toLocaleTimeString()); //æ­£åˆ
				$("#today_sunset").html(sun_times.sunset.toLocaleTimeString()); //æ—¥è½
				$("#today_sun_azimuth").html(angle_trans((sun_position.azimuth / Math.PI) * 180)); //å¤ªé˜³æ°´å¹³å¼§åº¦
				$("#today_moon_azimuth").html(angle_trans((moon_position.azimuth / Math.PI) * 180)); //æœˆäº®æ°´å¹³å¼§åº¦
				$("#today_moon_phase").html(phase(today).phase); //æœˆç›¸å€¼
				$("#today_moon_percent").html(phase(today).illuminated); //æœˆç…§åº¦
				$("#today_moon_angle").html(angle_trans((moon_Illumination.angle / Math.PI) * 180)); //æœˆç›¸è§’
				$("#angle_sun_e_moon").html(
					angle_trans((Math.abs(Math.PI + sun_position.azimuth - moon_position.azimuth) / Math.PI) * 180)
				); //æœˆäº®æ°´å¹³å¼§åº¦
				$("#curr_time").html(today.toLocaleTimeString()); //å½“å‰æ—¶é—´
				$("#now_time").html(g_now_date.toLocaleTimeString()); //ç°åœ¨
				$("#curr_time_unix").html(today.getTime()); //æ™‚é–“æˆ³

				let earth_angle_string = "";
				earth_angle_string += get_position(today).solar_position_angle + "â€”â€”";
				earth_angle_string += get_position(today).solar_position_angle_round + "â€”â€”";
				earth_angle_string += get_position(today).solar_station + "â€”â€”";
				earth_angle_string += get_station_name(today).solar.icon;
				$("#earth_angle").html(earth_angle_string); //åœ°çƒè§’åº¦

				let moon_angle_string = "";
				moon_angle_string += get_position(today).lunar_position_angle + "â€”â€”";
				moon_angle_string += get_position(today).lunar_position_angle_round + "â€”â€”";
				moon_angle_string += get_position(today).lunar_station + "â€”â€”";
				moon_angle_string += get_station_name(today).lunar.value;
				$("#moon_angle").html(moon_angle_string); //æœˆäº®è§’åº¦â€”â€”è§’åº¦å·®ç®—æ³•

				let moon_angle_string2 = "";
				moon_angle_string2 += get_position(today).lunar_position_angle2 + "â€”â€”";
				moon_angle_string2 += get_position(today).lunar_position_angle_round2 + "â€”â€”";
				moon_angle_string2 += get_position(today).lunar_station2 + "â€”â€”";
				moon_angle_string2 += get_station_name(today).lunar.value;
				$("#moon_angle2").html(moon_angle_string2); //æœˆäº®è§’åº¦â€”â€”å‘é‡å·®ç®—æ³•
			}
			//æ ¹æ®æ—¶é—´è®¡ç®—åè§’ï¼Œè¾“å‡º
			function get_position(date_time) {
				let planets_position = new Object();
				planets = window.lagrange.planet_positions.getPositions(date_time);
				//planets = global.planet_positions.getPositions(today);
				//console.log(planets)//è¾“å‡ºåˆ°æ§åˆ¶å°
				earth_position = window.lagrange.planet_positions.getPositions(date_time)[3];
				lunar_position = window.lagrange.planet_positions.getPositions(date_time)[11];
				let lunar_position_angle = 0;
				let lunar_station = 0;
				let earth_position_angle = 0;
				let earth_station = 0;
				let earth_position_angle_round = 0;
				let lunar_position_angle_round = 0;
				//å¤ªé˜³ç›¸å¯¹åœ°çƒçš„é»„é“åè§’
				if (earth_position.position.y >= 0) {
					earth_position_angle = Math.atan2(earth_position.position.y, earth_position.position.x);
				} else {
					earth_position_angle =
						Math.PI * 2 + Math.atan2(earth_position.position.y, earth_position.position.x);
				}
				earth_position_angle_round = earth_position_angle / Math.PI / 2 + 0.5;
				earth_position_angle_round = earth_position_angle_round - Math.floor(earth_position_angle_round);
				earth_station = earth_position_angle_round * 12;
				planets_position.solar_station = earth_station;
				planets_position.solar_position_angle = earth_position_angle_round * Math.PI * 2;
				planets_position.solar_position_angle_round = earth_position_angle_round;
				//æœˆçƒç›¸å¯¹åœ°çƒçš„é»„é“åè§’â€”â€”è§’åº¦å·®ç®—æ³•
				lunar_position_angle_round = earth_position_angle_round + phase(date_time).phase;
				lunar_position_angle_round = lunar_position_angle_round - Math.floor(lunar_position_angle_round);
				lunar_position_angle = lunar_position_angle_round * Math.PI * 2;
				lunar_station = lunar_position_angle_round * 27;
				//æœˆçƒç›¸å¯¹åœ°çƒçš„é»„é“åè§’ç®—æ³•â€”â€”å‘é‡å·®ç®—æ³•
				let lunar_to_earth = new Object();
				lunar_to_earth.y = lunar_position.position.y - earth_position.position.y;
				lunar_to_earth.x = lunar_position.position.x - earth_position.position.x;
				if (lunar_to_earth.y >= 0) {
					lunar_position_angle2 = Math.atan2(lunar_to_earth.y, lunar_to_earth.x);
				} else {
					lunar_position_angle2 = Math.PI * 2 + Math.atan2(lunar_to_earth.y, lunar_to_earth.x);
				}
				lunar_position_angle_round2 = lunar_position_angle2 / Math.PI / 2;
				//lunar_position_angle_round = lunar_position_angle_round - Math.floor(lunar_position_angle_round)
				lunar_position_angle2 = lunar_position_angle_round2 * Math.PI * 2;

				lunar_station2 = lunar_position_angle_round2 * 27;

				planets_position.lunar_station = lunar_station; //æœˆç«™å€¼ã€è§’åº¦å·®ç®—å¤¹è§’ã€‘
				planets_position.lunar_position_angle = lunar_position_angle; //æœˆç«™è§’ã€è§’åº¦å·®ç®—å¤¹è§’ã€‘
				planets_position.lunar_position_angle_round = lunar_position_angle_round; //æœˆç«™åœ†å‘¨æ¯”ç‡ã€è§’åº¦å·®ç®—å¤¹è§’ã€‘
				planets_position.lunar_station2 = lunar_station2; //æœˆç«™å€¼ã€çŸ¢é‡å·®ç®—å¤¹è§’ã€‘
				planets_position.lunar_position_angle2 = lunar_position_angle2; //æœˆç«™è§’ã€çŸ¢é‡å·®ç®—å¤¹è§’ã€‘
				planets_position.lunar_position_angle_round2 = lunar_position_angle_round2; //æœˆç«™åœ†å‘¨æ¯”ç‡ã€çŸ¢é‡å·®ç®—å¤¹è§’ã€‘
				return planets_position;
			}
			//æ ¹æ®;
			function get_station_name(data_time) {
				//è·å–æ˜Ÿè±¡ä¿¡æ¯
				let solar_num = 0;
				let lunar_num = 0;
				solar_num = get_position(data_time).solar_station;
				solar_num = Math.floor(solar_num);
				lunar_num = get_position(data_time).lunar_station;
				lunar_num = Math.floor(lunar_num);

				let result = new Object();
				result.solar = horoscope_name[solar_num]; //é»„é“åäºŒå®«æ˜Ÿè±¡åç§°
				result.lunar = pali_nakkhatta_name[lunar_num]; //27æ˜Ÿå®¿æœˆç«™åç§°
				return result;
			}
			function getLocation() {
				//è‡ªåŠ¨å®šä½
				if (navigator.geolocation) {
					navigator.geolocation.getCurrentPosition(showPosition, showError);
				} else {
					$("#selected_position_string").html("Geolocation is not supported by this browser.");
				}
			}
			function showPosition(position) {
				alert("get cordinate success");
				g_coordinate_this.AT = position.coords.latitude; //çº¬åº¦
				g_coordinate_this.LT = position.coords.longitude; //ç»åº¦
				g_coordinate_this.height = position.coords.altitude; //æµ·æ‹”é«˜åº¦
				//æ‰‹åŠ¨è¾“å…¥
				var LT = Number($("#LT_Â°")[0].value);
				LT += Number($("#LT_â€™")[0].value) / 60;
				LT += Number($("#LT_â€")[0].value) / 3600;
				LT = Number($("#WE")[0].value + LT);
				var AT = Number($("#AT_Â°")[0].value);
				AT += Number($("#AT_â€™")[0].value) / 60;
				AT += Number($("#AT_â€")[0].value) / 3600;
				AT = Number($("#NS")[0].value + AT);
				if (AT != 0) {
					g_coordinate_this.LT = LT;
					g_coordinate_this.AT = AT;
				}

				let position_string =
					g_coordinate_this.AT + "#" + g_coordinate_this.LT + "#" + g_coordinate_this.height;
				localStorage.setItem("local_position", position_string);

				if (g_coordinate_this.AT >= 0) {
					var AT_string = angle_trans(g_coordinate_this.AT) + "N";
				} else {
					var AT_string = angle_trans(g_coordinate_this.AT) + "S";
				}
				if (g_coordinate_this.LT >= 0) {
					var LT_string = angle_trans(g_coordinate_this.LT) + "E";
				} else {
					var LT_string = angle_trans(g_coordinate_this.LT) + "W";
				}
				let height_string = g_coordinate_this.height + "M";
				$("#selected_position_string").html(AT_string + " " + LT_string + " " + height_string);
				$("#position_input").hide();
			}
			function showError(error) {
				switch (error.code) {
					case error.PERMISSION_DENIED:
						alert("å®šä½å¤±è´¥,ç”¨æˆ·æ‹’ç»è¯·æ±‚åœ°ç†å®šä½");
						break;
					case error.POSITION_UNAVAILABLE:
						alert("å®šä½å¤±è´¥,ä½ç½®ä¿¡æ¯æ˜¯ä¸å¯ç”¨");
						break;
					case error.TIMEOUT:
						alert("å®šä½å¤±è´¥,è¯·æ±‚è·å–ç”¨æˆ·ä½ç½®è¶…æ—¶");
						break;
					case error.UNKNOWN_ERROR:
						alert("å®šä½å¤±è´¥,å®šä½ç³»ç»Ÿå¤±æ•ˆ");
						break;
				}
			}
			function angle_trans(angle) {
				var angle_str = "";
				var num_d = Math.floor(angle);
				var num_m = Math.floor((angle - num_d) * 60);
				var num_s = Math.round((angle - num_d) * 60 - num_m);
				if (num_d != 0) {
					angle_str += num_d + "Â°";
				}
				if (num_m != 0) {
					angle_str += num_m + "â€™";
				}
				if (num_s != 0) {
					angle_str += num_s + "â€";
				}
				return angle_str;
			}
			function input_position() {
				$("#position_input").show();
			}
			var g_event_list_arr = new Array();
			function get_event_arr() {
				let today = new Date();
				let date = new Date();
				for (i = -360; i < 360; i++) {
					date.setTime(today.getTime() + i * 3600 * 24 * 1000);
					let info_obj = new Object();
					info_obj.id = "dawn" + i;
					info_obj.title = localString[g_language].twilight_time;
					info_obj.start = SunCalc.getTimes(
						date,
						g_coordinate_this.AT,
						g_coordinate_this.LT,
						g_coordinate_this.height / 1000
					).dawn;
					g_event_list_arr.push(info_obj);

					info_obj = new Object();
					info_obj.id = "noon" + i;
					info_obj.title = "â˜€ï¸";
					info_obj.start = SunCalc.getTimes(
						date,
						g_coordinate_this.AT,
						g_coordinate_this.LT,
						g_coordinate_this.height / 1000
					).solarNoon;

					g_event_list_arr.push(info_obj);
					info_obj = new Object();
					info_obj.id = "sunset" + i;
					info_obj.title = "ğŸŒ‡";
					info_obj.start = SunCalc.getTimes(
						date,
						g_coordinate_this.AT,
						g_coordinate_this.LT,
						g_coordinate_this.height / 1000
					).sunset;
					g_event_list_arr.push(info_obj);
				}

				next_year.setDate(start_day.getDate() + 360);
				start_day.setDate(today.getDate() - 360);
				last_list = phaseRange(start_day, next_year, LAST); //è·å–ä¸‹å¼¦æœˆåˆ—è¡¨
				for (i_last in last_list) {
					info_obj = new Object();
					info_obj.id = "last_moon" + i_last;
					info_obj.title = "ğŸŒ—" + get_station_name(last_list[i_last]).lunar.value;
					info_obj.start = last_list[i_last];
					g_event_list_arr.push(info_obj);
				}
				new_list = phaseRange(start_day, next_year, NEW); //è·å–æ–°æœˆåˆ—è¡¨
				for (i_new in new_list) {
					info_obj = new Object();
					info_obj.id = "new_moon" + i_new;
					info_obj.title = "ğŸŒ‘" + get_station_name(new_list[i_new]).lunar.value;
					info_obj.start = new_list[i_new];
					g_event_list_arr.push(info_obj);
				}
				first_list = phaseRange(start_day, next_year, FIRST); //è·å–ä¸Šå¼¦æœˆåˆ—è¡¨
				for (i_first in first_list) {
					info_obj = new Object();
					info_obj.id = "first_moon" + i_first;
					info_obj.title = "ğŸŒ“" + get_station_name(first_list[i_first]).lunar.value;
					info_obj.start = first_list[i_first];
					g_event_list_arr.push(info_obj);
				}
				full_list = phaseRange(start_day, next_year, FULL); //è·å–æ»¡æœˆåˆ—è¡¨
				for (i_full in full_list) {
					info_obj = new Object();
					info_obj.id = "full_moon" + i_full;
					info_obj.title = "ğŸŒ•" + get_station_name(full_list[i_full]).lunar.value;
					info_obj.start = full_list[i_full];
					g_event_list_arr.push(info_obj);
				}

				/*console.log(last_list); //è¾“å‡ºåˆ°æ§åˆ¶å°
				console.log(new_list); //è¾“å‡ºåˆ°æ§åˆ¶å°
				console.log(first_list); //è¾“å‡ºåˆ°æ§åˆ¶å°
				console.log(full_list); //è¾“å‡ºåˆ°æ§åˆ¶å°*/
			}
			get_event_arr();
		</script>
		<script src="../lib/main.js"></script>
		<script>
			function getCookie(name) {
				var start = document.cookie.indexOf(name + "=");
				var len = start + name.length + 1;
				if (!start && name != document.cookie.substring(0, name.length)) {
					return null;
				}
				if (start == -1) return null;
				var end = document.cookie.indexOf(";", len);
				if (end == -1) end = document.cookie.length;
				return decodeURI(document.cookie.substring(len, end));
			}

			document.addEventListener("DOMContentLoaded", function () {
				var initialTimeZone = "local";
				var timeZoneSelectorEl = document.getElementById("time-zone-selector");
				var loadingEl = document.getElementById("loading");
				var calendarEl = document.getElementById("calendar");

				var calendar = new FullCalendar.Calendar(calendarEl, {
					timeZone: initialTimeZone,
					locale: getCookie("language"),
					headerToolbar: {
						left: "prev,next today",
						center: "title",
						right: "dayGridMonth,timeGridWeek,timeGridDay,listWeek",
					},
					//initialDate: "2020-12-12",
					navLinks: true, // can click day/week names to navigate views
					editable: true,
					selectable: true,
					dayMaxEvents: true, // allow "more" link when too many events
					//resources: g_event_list_arr,
					events: g_event_list_arr,
					eventClick: function (info) {
						info.jsEvent.preventDefault(); // don't let the browser navigate

						if (info.event.url) {
							window.open(info.event.url);
						}
					},

					loading: function (bool) {
						if (bool) {
							loadingEl.style.display = "inline"; // show
						} else {
							loadingEl.style.display = "none"; // hide
						}
					},

					eventTimeFormat: { hour: "numeric", minute: "2-digit" },

					dateClick: function (arg) {
						console.log("dateClick", calendar.formatIso(arg.date));
					},
					select: function (arg) {
						console.log("select", calendar.formatIso(arg.start), calendar.formatIso(arg.end));
					},
				});

				calendar.render();

				// load the list of available timezones, build the <select> options
				// it's HIGHLY recommended to use a different library for network requests, not this internal util func
				FullCalendar.requestJson(
					"GET",
					"php/get-time-zones.php",
					{},
					function (timeZones) {
						timeZones.forEach(function (timeZone) {
							var optionEl;

							if (timeZone !== "UTC") {
								// UTC is already in the list
								optionEl = document.createElement("option");
								optionEl.value = timeZone;
								optionEl.innerText = timeZone;
								timeZoneSelectorEl.appendChild(optionEl);
							}
						});
					},
					function () {
						// TODO: handle error
					}
				);

				// when the timezone selector changes, dynamically change the calendar option
				timeZoneSelectorEl.addEventListener("change", function () {
					calendar.setOption("timeZone", this.value);
				});
			});
		</script>
		<style>
			body {
				margin: 0;
				padding: 0;
				font-family: Arial, Helvetica Neue, Helvetica, sans-serif;
				font-size: 14px;
			}

			#top {
				background: #eee;
				border-bottom: 1px solid #ddd;
				padding: 0 10px;
				line-height: 40px;
				font-size: 12px;
			}
			.left {
				float: left;
			}
			.right {
				float: right;
			}
			.clear {
				clear: both;
			}

			#script-warning,
			#loading {
				display: none;
			}
			#script-warning {
				font-weight: bold;
				color: red;
			}

			#calendar {
				max-width: 1100px;
				margin: 40px auto;
				padding: 0 10px;
			}

			.tzo {
				color: #000;
			}
		</style>
	</head>
	<body>
		<div id="top">
			<div class="left">
				<script>
					document.write(localString[g_language].timezone + "ï¼š");
				</script>
				<select id="time-zone-selector">
					<option value="local" selected>
						<script>
							document.write(localString[g_language].local);
						</script>
					</option>
					<option value="UTC">UTC</option>
				</select>
			</div>

			<div class="right">
				<span id="loading">
					<script>
						document.write(localString[g_language].loading + "â€¦");
					</script>
				</span>
				<span id="script-warning"><code>php/get-events.php</code> must be running.</span>
			</div>

			<div class="clear"></div>
		</div>

		<div id="calendar"></div>
	</body>
</html>
